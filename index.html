<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Malangu√≠simas</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Animaciones personalizadas */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }
        
        .animate-slideIn {
            animation: slideIn 0.3s ease-out;
        }
        
        /* Loader mejorado */
        .loader {
            border: 3px solid rgba(249, 115, 22, 0.1);
            border-top: 3px solid #f97316;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Efectos hover mejorados */
        .hover-scale {
            transition: all 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        /* Gradientes */
        .gradient-orange {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        
        .gradient-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .gradient-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .gradient-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        /* Cards con efecto glassmorphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #f97316;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #ea580c;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Botones con efecto ripple */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }
        
        .btn-ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-ripple:active::before {
            width: 300px;
            height: 300px;
        }
        
        .hidden { display: none !important; }
        
        /* Mejora para las tablas */
        .table-hover tbody tr:hover {
            background-color: #fef3c7;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Barra Superior -->
    <nav class="bg-white shadow-xl fixed w-full top-0 z-50 border-b border-gray-100">
        <div class="px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <i class="fas fa-fire text-3xl text-orange-500 animate-pulse"></i>
                    <div class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-ping"></div>
                </div>
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">
                        Malangu√≠simas ERP
                    </h1>
                    <p class="text-xs text-gray-500">Sistema de Gesti√≥n Empresarial</p>
                </div>
            </div>
            <div class="flex items-center space-x-6">
                <div class="tooltip">
                    <span id="currentTime" class="text-sm text-gray-600"></span>
                    <span class="tooltiptext">Hora actual</span>
                </div>
                <div class="flex items-center space-x-2 bg-green-50 px-4 py-2 rounded-full">
                    <i class="fas fa-circle text-green-500 text-xs animate-pulse"></i>
                    <span class="text-sm font-medium text-green-700">Modo Local</span>
                </div>
                <button class="relative p-2 text-gray-600 hover:text-orange-500 transition-colors">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="pt-24 px-6 pb-6">
        <!-- Men√∫ de navegaci√≥n mejorado -->
        <div class="glass-card rounded-2xl shadow-lg p-6 mb-8 animate-fadeIn">
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                <button onclick="showSection('dashboard')" class="menu-btn group relative overflow-hidden px-6 py-4 gradient-orange text-white rounded-xl hover-scale btn-ripple transition-all">
                    <div class="relative z-10">
                        <i class="fas fa-home text-2xl mb-2 block"></i>
                        <span class="text-sm font-medium">Dashboard</span>
                    </div>
                </button>
                <button onclick="showSection('productos')" class="menu-btn group relative overflow-hidden px-6 py-4 bg-white text-gray-700 rounded-xl hover-scale hover:shadow-lg transition-all border border-gray-200">
                    <div class="relative z-10">
                        <i class="fas fa-box text-2xl mb-2 block text-orange-500"></i>
                        <span class="text-sm font-medium">Productos</span>
                    </div>
                </button>
                <button onclick="showSection('ventas')" class="menu-btn group relative overflow-hidden px-6 py-4 bg-white text-gray-700 rounded-xl hover-scale hover:shadow-lg transition-all border border-gray-200">
                    <div class="relative z-10">
                        <i class="fas fa-shopping-cart text-2xl mb-2 block text-green-500"></i>
                        <span class="text-sm font-medium">Ventas</span>
                    </div>
                </button>
                <button onclick="showSection('contabilidad')" class="menu-btn group relative overflow-hidden px-6 py-4 bg-white text-gray-700 rounded-xl hover-scale hover:shadow-lg transition-all border border-gray-200">
                    <div class="relative z-10">
                        <i class="fas fa-calculator text-2xl mb-2 block text-blue-500"></i>
                        <span class="text-sm font-medium">Contabilidad</span>
                    </div>
                </button>
                <button onclick="showSection('reportes')" class="menu-btn group relative overflow-hidden px-6 py-4 bg-white text-gray-700 rounded-xl hover-scale hover:shadow-lg transition-all border border-gray-200">
                    <div class="relative z-10">
                        <i class="fas fa-chart-bar text-2xl mb-2 block text-purple-500"></i>
                        <span class="text-sm font-medium">Reportes</span>
                    </div>
                </button>
                <button onclick="showSection('configuracion')" class="menu-btn group relative overflow-hidden px-6 py-4 bg-white text-gray-700 rounded-xl hover-scale hover:shadow-lg transition-all border border-gray-200">
                    <div class="relative z-10">
                        <i class="fas fa-cog text-2xl mb-2 block text-gray-500"></i>
                        <span class="text-sm font-medium">Config</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Secci√≥n Dashboard -->
        <section id="dashboard" class="content-section animate-fadeIn">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Dashboard Principal</h2>
                <button onclick="updateDashboard()" class="text-gray-500 hover:text-orange-500 transition-colors tooltip">
                    <i class="fas fa-sync-alt text-xl"></i>
                    <span class="tooltiptext">Actualizar</span>
                </button>
            </div>
            
            <!-- Tarjetas de m√©tricas mejoradas -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass-card p-6 rounded-2xl shadow-lg hover-scale transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 gradient-green rounded-xl">
                            <i class="fas fa-chart-line text-2xl text-white"></i>
                        </div>
                        <span class="text-xs font-medium text-green-600 bg-green-50 px-3 py-1 rounded-full">
                            <i class="fas fa-arrow-up mr-1"></i>12%
                        </span>
                    </div>
                    <p class="text-gray-600 text-sm mb-1">Ventas del Mes</p>
                    <p class="text-3xl font-bold text-gray-800" id="ventasMes">$0.00</p>
                </div>
                
                <div class="glass-card p-6 rounded-2xl shadow-lg hover-scale transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 gradient-blue rounded-xl">
                            <i class="fas fa-box text-2xl text-white"></i>
                        </div>
                        <span class="text-xs font-medium text-blue-600 bg-blue-50 px-3 py-1 rounded-full">
                            En stock
                        </span>
                    </div>
                    <p class="text-gray-600 text-sm mb-1">Productos en Stock</p>
                    <p class="text-3xl font-bold text-gray-800" id="totalStock">0</p>
                </div>
                
                <div class="glass-card p-6 rounded-2xl shadow-lg hover-scale transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 gradient-purple rounded-xl">
                            <i class="fas fa-users text-2xl text-white"></i>
                        </div>
                        <span class="text-xs font-medium text-purple-600 bg-purple-50 px-3 py-1 rounded-full">
                            Activos
                        </span>
                    </div>
                    <p class="text-gray-600 text-sm mb-1">Total Clientes</p>
                    <p class="text-3xl font-bold text-gray-800" id="totalClientes">0</p>
                </div>
                
                <div class="glass-card p-6 rounded-2xl shadow-lg hover-scale transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 gradient-orange rounded-xl">
                            <i class="fas fa-dollar-sign text-2xl text-white"></i>
                        </div>
                        <span class="text-xs font-medium text-orange-600 bg-orange-50 px-3 py-1 rounded-full">
                            <i class="fas fa-arrow-up mr-1"></i>8%
                        </span>
                    </div>
                    <p class="text-gray-600 text-sm mb-1">Utilidad del Mes</p>
                    <p class="text-3xl font-bold text-gray-800" id="utilidad">$0.00</p>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="glass-card p-6 rounded-2xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Ventas Semanales</h3>
                    <canvas id="salesChart" height="200"></canvas>
                </div>
                <div class="glass-card p-6 rounded-2xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Productos M√°s Vendidos</h3>
                    <canvas id="productsChart" height="200"></canvas>
                </div>
            </div>

            <!-- Tabla de productos con bajo stock mejorada -->
            <div class="glass-card rounded-2xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                        Productos con Bajo Stock
                    </h3>
                    <span class="text-sm text-gray-500">Stock menor a 10 unidades</span>
                </div>
                <div id="lowStockProducts" class="overflow-x-auto">
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-5xl text-green-500 mb-3"></i>
                        <p class="text-gray-500">¬°Excelente! No hay productos con bajo stock</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n Productos -->
        <section id="productos" class="content-section hidden animate-fadeIn">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                <h2 class="text-3xl font-bold text-gray-800">Gesti√≥n de Productos</h2>
                <div class="flex gap-3">
                    <button onclick="showProductForm()" class="gradient-orange text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all flex items-center gap-2 btn-ripple">
                        <i class="fas fa-plus"></i>
                        <span>Nuevo Producto</span>
                    </button>
                </div>
            </div>

            <!-- Buscador -->
            <div class="glass-card p-4 rounded-xl shadow mb-6">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" placeholder="Buscar productos..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-orange-500" onkeyup="searchProducts(this.value)">
                </div>
            </div>

            <!-- Formulario de Producto mejorado -->
            <div id="productForm" class="hidden glass-card p-8 rounded-2xl shadow-lg mb-8 animate-slideIn">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-box mr-2 text-orange-500"></i>
                        Agregar Producto
                    </h3>
                    <button onclick="hideProductForm()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form onsubmit="saveProduct(event)">
                    <input type="hidden" id="productId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-tag mr-1 text-orange-500"></i>Nombre del Producto
                            </label>
                            <input type="text" id="productName" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all" placeholder="Ej: Chicharr√≥n Especial" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-weight mr-1 text-orange-500"></i>Tama√±o
                            </label>
                            <select id="productSize" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all">
                                <option value="50g">50 gramos</option>
                                <option value="100g">100 gramos</option>
                                <option value="200g">200 gramos</option>
                                <option value="500g">500 gramos</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-pepper-hot mr-1 text-orange-500"></i>Sabor
                            </label>
                            <select id="productFlavor" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all">
                                <option value="fuego">üî• Fuego</option>
                                <option value="habanero">üå∂Ô∏è Habanero</option>
                                <option value="jalape√±o">üå∂Ô∏è Jalape√±o</option>
                                <option value="natural">ü•î Natural</option>
                                <option value="chipotle">üå∂Ô∏è Chipotle</option>
                                <option value="lim√≥n">üçã Lim√≥n</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-cubes mr-1 text-orange-500"></i>Stock Inicial
                            </label>
                            <input type="number" id="productStock" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all" placeholder="0" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-truck mr-1 text-orange-500"></i>Precio Mayoreo
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                <input type="number" id="productWholesalePrice" step="0.01" class="w-full pl-8 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all" placeholder="0.00" required>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-store mr-1 text-orange-500"></i>Precio Menudeo
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                <input type="number" id="productRetailPrice" step="0.01" class="w-full pl-8 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all" placeholder="0.00" required>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-end gap-3">
                        <button type="button" onclick="hideProductForm()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                            Cancelar
                        </button>
                        <button type="submit" class="px-6 py-3 gradient-green text-white rounded-lg hover:shadow-lg transition-all flex items-center gap-2">
                            <i class="fas fa-save"></i>
                            <span>Guardar Producto</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Lista de Productos mejorada -->
            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full table-hover">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Producto</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Tama√±o</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Sabor</th>
                                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Stock</th>
                                <th class="px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">P. Mayoreo</th>
                                <th class="px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">P. Menudeo</th>
                                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="productsList" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="7" class="px-6 py-12 text-center">
                                    <i class="fas fa-box-open text-5xl text-gray-300 mb-3"></i>
                                    <p class="text-gray-500">No hay productos registrados</p>
                                    <button onclick="showProductForm()" class="mt-3 text-orange-500 hover:text-orange-600 font-medium">
                                        Agregar primer producto ‚Üí
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Secci√≥n Ventas -->
        <section id="ventas" class="content-section hidden animate-fadeIn">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                <h2 class="text-3xl font-bold text-gray-800">Registro de Ventas</h2>
                <button onclick="showSaleForm()" class="gradient-orange text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all flex items-center gap-2 btn-ripple">
                    <i class="fas fa-cash-register"></i>
                    <span>Nueva Venta</span>
                </button>
            </div>

            <!-- Estad√≠sticas r√°pidas -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="glass-card p-4 rounded-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Ventas Hoy</p>
                            <p class="text-2xl font-bold text-gray-800" id="ventasHoy">$0.00</p>
                        </div>
                        <i class="fas fa-calendar-day text-3xl text-blue-500"></i>
                    </div>
                </div>
                <div class="glass-card p-4 rounded-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Ticket Promedio</p>
                            <p class="text-2xl font-bold text-gray-800" id="ticketPromedio">$0.00</p>
                        </div>
                        <i class="fas fa-receipt text-3xl text-green-500"></i>
                    </div>
                </div>
                <div class="glass-card p-4 rounded-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Total Transacciones</p>
                            <p class="text-2xl font-bold text-gray-800" id="totalTransacciones">0</p>
                        </div>
                        <i class="fas fa-exchange-alt text-3xl text-purple-500"></i>
                    </div>
                </div>
            </div>

            <!-- Formulario de Venta mejorado -->
            <div id="saleForm" class="hidden glass-card p-8 rounded-2xl shadow-lg mb-8 animate-slideIn">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-shopping-cart mr-2 text-green-500"></i>
                        Registrar Nueva Venta
                    </h3>
                    <button onclick="hideSaleForm()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form onsubmit="saveSale(event)">
                    <!-- Informaci√≥n del cliente -->
                    <div class="bg-gray-50 p-6 rounded-xl mb-6">
                        <h4 class="font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-user mr-2 text-orange-500"></i>
                            Informaci√≥n del Cliente
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Cliente</label>
                                <input type="text" id="customerName" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Ej: Juan P√©rez" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Cliente</label>
                                <select id="customerType" onchange="updatePrices()" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="menudeo">üè™ Menudeo</option>
                                    <option value="mayoreo">üè≠ Mayoreo</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Venta</label>
                                <input type="date" id="saleDate" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- L√≠neas de venta -->
                    <div class="bg-gray-50 p-6 rounded-xl mb-6">
                        <h4 class="font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-box mr-2 text-orange-500"></i>
                            Productos
                        </h4>
                        <div id="saleLines" class="space-y-3"></div>
                        <button type="button" onclick="addSaleLine()" class="mt-4 text-green-600 hover:text-green-700 font-medium flex items-center gap-2 transition-colors">
                            <i class="fas fa-plus-circle"></i>
                            Agregar Producto
                        </button>
                    </div>

                    <!-- Total y acciones -->
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Total a Pagar</p>
                                <p class="text-4xl font-bold text-gray-800">$<span id="saleTotal">0.00</span></p>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" onclick="hideSaleForm()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-6 py-3 gradient-green text-white rounded-lg hover:shadow-lg transition-all flex items-center gap-2 btn-ripple">
                                    <i class="fas fa-check"></i>
                                    <span>Registrar Venta</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Lista de Ventas mejorada -->
            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full table-hover">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Fecha</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cliente</th>
                                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Tipo</th>
                                <th class="px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="salesList" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center">
                                    <i class="fas fa-shopping-cart text-5xl text-gray-300 mb-3"></i>
                                    <p class="text-gray-500">No hay ventas registradas</p>
                                    <button onclick="showSaleForm()" class="mt-3 text-orange-500 hover:text-orange-600 font-medium">
                                        Registrar primera venta ‚Üí
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Secci√≥n Contabilidad -->
        <section id="contabilidad" class="content-section hidden animate-fadeIn">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">M√≥dulo de Contabilidad</h2>
            
            <!-- Men√∫ de Contabilidad mejorado -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <button onclick="showAccounting('cuentas')" class="glass-card p-8 rounded-2xl shadow-lg hover-scale transition-all text-center group">
                    <div class="w-16 h-16 gradient-blue rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-list text-3xl text-white"></i>
                    </div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">Cat√°logo de Cuentas</h3>
                    <p class="text-sm text-gray-600">Gestiona el plan contable</p>
                </button>
                <button onclick="showAccounting('polizas')" class="glass-card p-8 rounded-2xl shadow-lg hover-scale transition-all text-center group">
                    <div class="w-16 h-16 gradient-green rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-file-invoice text-3xl text-white"></i>
                    </div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">P√≥lizas Contables</h3>
                    <p class="text-sm text-gray-600">Registro de movimientos</p>
                </button>
                <button onclick="showAccounting('balanza')" class="glass-card p-8 rounded-2xl shadow-lg hover-scale transition-all text-center group">
                    <div class="w-16 h-16 gradient-purple rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-balance-scale text-3xl text-white"></i>
                    </div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">Balanza</h3>
                    <p class="text-sm text-gray-600">Estados financieros</p>
                </button>
            </div>

            <!-- Subsecciones mejoradas -->
            <div id="cuentas" class="accounting-section hidden animate-fadeIn">
                <div class="glass-card p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-list mr-2 text-blue-500"></i>
                            Cat√°logo de Cuentas
                        </h3>
                        <button onclick="addAccount()" class="gradient-blue text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>Nueva Cuenta
                        </button>
                    </div>
                    <div id="accountsList" class="space-y-3"></div>
                </div>
            </div>

            <div id="polizas" class="accounting-section hidden animate-fadeIn">
                <div class="glass-card p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-file-invoice mr-2 text-green-500"></i>
                            P√≥lizas Contables
                        </h3>
                        <button onclick="addPoliza()" class="gradient-green text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>Nueva P√≥liza
                        </button>
                    </div>
                    <div id="polizasList" class="space-y-3"></div>
                </div>
            </div>

            <div id="balanza" class="accounting-section hidden animate-fadeIn">
                <div class="glass-card p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-balance-scale mr-2 text-purple-500"></i>
                            Balanza de Comprobaci√≥n
                        </h3>
                        <button onclick="generateBalanza()" class="gradient-purple text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all">
                            <i class="fas fa-sync mr-2"></i>Generar Balanza
                        </button>
                    </div>
                    <div id="balanzaContent"></div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n Reportes -->
        <section id="reportes" class="content-section hidden animate-fadeIn">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">Centro de Reportes</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="glass-card p-8 rounded-2xl shadow-lg hover-scale transition-all text-center cursor-pointer group" onclick="generateReport('inventario')">
                    <div class="w-20 h-20 bg-gradient-to-br from-indigo-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-boxes text-4xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">Inventario</h3>
                    <p class="text-gray-600">An√°lisis detallado del inventario actual</p>
                </div>
                
                <div class="glass-card p-8 rounded-2xl shadow-lg hover-scale transition-all text-center cursor-pointer group" onclick="generateReport('ventas')">
                    <div class="w-20 h-20 bg-gradient-to-br from-orange-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-chart-pie text-4xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">An√°lisis de Ventas</h3>
                    <p class="text-gray-600">Estad√≠sticas y tendencias de ventas</p>
                </div>
                
                <div class="glass-card p-8 rounded-2xl shadow-lg hover-scale transition-all text-center cursor-pointer group" onclick="generateReport('resultados')">
                    <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i class="fas fa-file-invoice-dollar text-4xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">Estado de Resultados</h3>
                    <p class="text-gray-600">An√°lisis de utilidades y p√©rdidas</p>
                </div>
            </div>

            <div id="reportContent" class="animate-fadeIn"></div>
        </section>

        <!-- Secci√≥n Configuraci√≥n -->
        <section id="configuracion" class="content-section hidden animate-fadeIn">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">Configuraci√≥n del Sistema</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass-card p-8 rounded-2xl shadow-lg">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        Informaci√≥n del Sistema
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-code-branch text-gray-500"></i>
                                Versi√≥n
                            </span>
                            <span class="font-semibold text-gray-800">2.0.0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-server text-gray-500"></i>
                                Modo
                            </span>
                            <span class="font-semibold text-gray-800">Local (Sin Firebase)</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-database text-gray-500"></i>
                                Datos almacenados
                            </span>
                            <span class="font-semibold text-gray-800" id="dataCount">0 registros</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-hdd text-gray-500"></i>
                                Espacio usado
                            </span>
                            <span class="font-semibold text-gray-800" id="storageUsed">0 KB</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-8 rounded-2xl shadow-lg">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">
                        <i class="fas fa-tools mr-2 text-orange-500"></i>
                        Herramientas
                    </h3>
                    <div class="space-y-4">
                        <button onclick="exportData()" class="w-full p-4 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-all flex items-center justify-between group">
                            <span class="flex items-center gap-3">
                                <i class="fas fa-download text-xl"></i>
                                <div class="text-left">
                                    <p class="font-semibold">Exportar Datos</p>
                                    <p class="text-sm text-blue-600">Descargar backup en JSON</p>
                                </div>
                            </span>
                            <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                        
                        <button onclick="importData()" class="w-full p-4 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-all flex items-center justify-between group">
                            <span class="flex items-center gap-3">
                                <i class="fas fa-upload text-xl"></i>
                                <div class="text-left">
                                    <p class="font-semibold">Importar Datos</p>
                                    <p class="text-sm text-green-600">Restaurar desde archivo</p>
                                </div>
                            </span>
                            <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                        
                        <button onclick="clearData()" class="w-full p-4 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg transition-all flex items-center justify-between group">
                            <span class="flex items-center gap-3">
                                <i class="fas fa-trash text-xl"></i>
                                <div class="text-left">
                                    <p class="font-semibold">Limpiar Datos</p>
                                    <p class="text-sm text-red-600">Eliminar toda la informaci√≥n</p>
                                </div>
                            </span>
                            <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal de confirmaci√≥n -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 animate-fadeIn">
            <div class="text-center mb-6">
                <i class="fas fa-exclamation-triangle text-5xl text-yellow-500 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-800 mb-2" id="modalTitle">¬øEst√°s seguro?</h3>
                <p class="text-gray-600" id="modalMessage">Esta acci√≥n no se puede deshacer.</p>
            </div>
            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                    Cancelar
                </button>
                <button id="confirmButton" class="flex-1 px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast" class="fixed bottom-6 right-6 hidden animate-slideIn">
        <div class="bg-white rounded-lg shadow-xl p-4 flex items-center gap-3 min-w-[300px]">
            <div id="toastIcon" class="text-2xl"></div>
            <div>
                <p id="toastTitle" class="font-semibold text-gray-800"></p>
                <p id="toastMessage" class="text-sm text-gray-600"></p>
            </div>
            <button onclick="hideToast()" class="ml-auto text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // Estado de la aplicaci√≥n
        let appState = {
            products: [],
            sales: [],
            accounts: [
                { id: 1, number: '1101', name: 'Caja', type: 'Activo', balance: 0 },
                { id: 2, number: '4001', name: 'Ventas', type: 'Ingreso', balance: 0 },
                { id: 3, number: '5001', name: 'Costo de Ventas', type: 'Egreso', balance: 0 }
            ],
            polizas: [],
            currentSection: 'dashboard'
        };

        let salesChart = null;
        let productsChart = null;

        // Inicializar la aplicaci√≥n
        function init() {
            loadFromLocalStorage();
            showSection('dashboard');
            updateDashboard();
            updateTime();
            setInterval(updateTime, 1000);
            
            // Establecer fecha actual
            document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
            
            // Inicializar gr√°ficos
            initCharts();
        }

        // Actualizar reloj
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-MX', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            const dateString = now.toLocaleDateString('es-MX', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('currentTime').innerHTML = `${dateString}<br><strong>${timeString}</strong>`;
        }

        // Sistema de notificaciones toast
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            // Configurar icono y color seg√∫n el tipo
            const icons = {
                success: { icon: 'fas fa-check-circle', color: 'text-green-500' },
                error: { icon: 'fas fa-exclamation-circle', color: 'text-red-500' },
                warning: { icon: 'fas fa-exclamation-triangle', color: 'text-yellow-500' },
                info: { icon: 'fas fa-info-circle', color: 'text-blue-500' }
            };
            
            const config = icons[type] || icons.info;
            toastIcon.className = `${config.icon} ${config.color} text-2xl`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            toast.classList.remove('hidden');
            
            // Auto ocultar despu√©s de 5 segundos
            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        function hideToast() {
            document.getElementById('toast').classList.add('hidden');
        }

        // Modal de confirmaci√≥n
        function showConfirmModal(title, message, onConfirm) {
            const modal = document.getElementById('confirmModal');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const confirmButton = document.getElementById('confirmButton');
            confirmButton.onclick = () => {
                onConfirm();
                closeModal();
            };
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('confirmModal').classList.add('hidden');
        }

        // Guardar en localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('erpData', JSON.stringify(appState));
                updateStorageInfo();
            } catch (e) {
                showToast('Error', 'No se pudo guardar en el almacenamiento local', 'error');
            }
        }

        // Cargar de localStorage
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('erpData');
                if (savedData) {
                    appState = JSON.parse(savedData);
                }
                updateStorageInfo();
            } catch (e) {
                showToast('Error', 'No se pudieron cargar los datos guardados', 'error');
            }
        }

        // Actualizar informaci√≥n de almacenamiento
        function updateStorageInfo() {
            const dataCount = appState.products.length + appState.sales.length + appState.accounts.length;
            document.getElementById('dataCount').textContent = `${dataCount} registros`;
            
            const dataSize = new Blob([JSON.stringify(appState)]).size;
            const sizeInKB = (dataSize / 1024).toFixed(2);
            document.getElementById('storageUsed').textContent = `${sizeInKB} KB`;
        }

        // Navegaci√≥n
        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar la secci√≥n seleccionada
            const section = document.getElementById(sectionName);
            section.classList.remove('hidden');
            
            // Actualizar botones del men√∫
            document.querySelectorAll('.menu-btn').forEach(btn => {
                btn.classList.remove('gradient-orange', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700', 'border', 'border-gray-200');
                
                // Restablecer iconos a sus colores originales
                const icon = btn.querySelector('i');
                icon.classList.remove('text-white');
                if (btn.textContent.includes('Productos')) icon.classList.add('text-orange-500');
                else if (btn.textContent.includes('Ventas')) icon.classList.add('text-green-500');
                else if (btn.textContent.includes('Contabilidad')) icon.classList.add('text-blue-500');
                else if (btn.textContent.includes('Reportes')) icon.classList.add('text-purple-500');
                else if (btn.textContent.includes('Config')) icon.classList.add('text-gray-500');
            });
            
            // Marcar el bot√≥n activo
            if (event && event.target) {
                const btn = event.target.closest('.menu-btn');
                if (btn) {
                    btn.classList.remove('bg-white', 'text-gray-700', 'border', 'border-gray-200');
                    btn.classList.add('gradient-orange', 'text-white');
                    const icon = btn.querySelector('i');
                    icon.classList.remove('text-orange-500', 'text-green-500', 'text-blue-500', 'text-purple-500', 'text-gray-500');
                    icon.classList.add('text-white');
                }
            }
            
            appState.currentSection = sectionName;
            
            // Actualizar contenido seg√∫n la secci√≥n
            if (sectionName === 'productos') updateProductsList();
            if (sectionName === 'ventas') {
                updateSalesList();
                updateSalesStats();
            }
            if (sectionName === 'dashboard') {
                updateDashboard();
                updateCharts();
            }
            if (sectionName === 'configuracion') updateStorageInfo();
        }

        // Funciones de Productos
        function showProductForm() {
            document.getElementById('productForm').classList.remove('hidden');
            document.querySelector('#productForm form').reset();
            document.getElementById('productId').value = '';
        }

        function hideProductForm() {
            document.getElementById('productForm').classList.add('hidden');
        }

        function saveProduct(event) {
            event.preventDefault();
            
            const productId = document.getElementById('productId').value;
            const product = {
                id: productId || Date.now(),
                name: document.getElementById('productName').value,
                size: document.getElementById('productSize').value,
                flavor: document.getElementById('productFlavor').value,
                stock: parseInt(document.getElementById('productStock').value),
                wholesalePrice: parseFloat(document.getElementById('productWholesalePrice').value),
                retailPrice: parseFloat(document.getElementById('productRetailPrice').value)
            };
            
            if (productId) {
                // Actualizar producto existente
                const index = appState.products.findIndex(p => p.id == productId);
                appState.products[index] = product;
                showToast('Producto Actualizado', `${product.name} ha sido actualizado correctamente`, 'success');
            } else {
                // Agregar nuevo producto
                appState.products.push(product);
                showToast('Producto Agregado', `${product.name} ha sido agregado al inventario`, 'success');
            }
            
            saveToLocalStorage();
            updateProductsList();
            hideProductForm();
        }

        function editProduct(id) {
            const product = appState.products.find(p => p.id == id);
            if (product) {
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productSize').value = product.size;
                document.getElementById('productFlavor').value = product.flavor;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productWholesalePrice').value = product.wholesalePrice;
                document.getElementById('productRetailPrice').value = product.retailPrice;
                showProductForm();
            }
        }

        function deleteProduct(id) {
            const product = appState.products.find(p => p.id == id);
            showConfirmModal(
                'Eliminar Producto',
                `¬øEst√°s seguro de eliminar "${product.name}"? Esta acci√≥n no se puede deshacer.`,
                () => {
                    appState.products = appState.products.filter(p => p.id != id);
                    saveToLocalStorage();
                    updateProductsList();
                    showToast('Producto Eliminado', 'El producto ha sido eliminado correctamente', 'success');
                }
            );
        }

        function updateProductsList() {
            const tbody = document.getElementById('productsList');
            
            if (appState.products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center">
                            <i class="fas fa-box-open text-5xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">No hay productos registrados</p>
                            <button onclick="showProductForm()" class="mt-3 text-orange-500 hover:text-orange-600 font-medium">
                                Agregar primer producto ‚Üí
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = appState.products.map(product => {
                const stockClass = product.stock < 10 ? 'text-red-600 font-bold' : product.stock < 20 ? 'text-yellow-600 font-semibold' : 'text-green-600';
                const stockIcon = product.stock < 10 ? '<i class="fas fa-exclamation-triangle text-red-500 mr-1"></i>' : '';
                
                return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-box text-orange-500"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">${product.name}</div>
                                    <div class="text-sm text-gray-500">SKU: ${product.id}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">
                                ${product.size}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-medium bg-orange-100 text-orange-800 rounded-full">
                                ${product.flavor}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="${stockClass}">
                                ${stockIcon}${product.stock}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right font-medium">$${product.wholesalePrice.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right font-medium">$${product.retailPrice.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button onclick="editProduct(${product.id})" class="text-indigo-600 hover:text-indigo-900 mr-3 tooltip">
                                <i class="fas fa-edit"></i>
                                <span class="tooltiptext">Editar</span>
                            </button>
                            <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-900 tooltip">
                                <i class="fas fa-trash"></i>
                                <span class="tooltiptext">Eliminar</span>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Funci√≥n de b√∫squeda de productos
        function searchProducts(query) {
            const filteredProducts = appState.products.filter(product => 
                product.name.toLowerCase().includes(query.toLowerCase()) ||
                product.flavor.toLowerCase().includes(query.toLowerCase()) ||
                product.size.toLowerCase().includes(query.toLowerCase())
            );
            
            const tbody = document.getElementById('productsList');
            if (filteredProducts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center">
                            <i class="fas fa-search text-5xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">No se encontraron productos con "${query}"</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Reutilizar la l√≥gica de updateProductsList pero con productos filtrados
            const tempProducts = appState.products;
            appState.products = filteredProducts;
            updateProductsList();
            appState.products = tempProducts;
        }

        // Funciones de Ventas
        function showSaleForm() {
            document.getElementById('saleForm').classList.remove('hidden');
            document.getElementById('saleLines').innerHTML = '';
            addSaleLine();
        }

        function hideSaleForm() {
            document.getElementById('saleForm').classList.add('hidden');
        }

        function addSaleLine() {
            const lineId = Date.now();
            const lineHTML = `
                <div class="sale-line bg-white p-4 rounded-lg border border-gray-200 animate-fadeIn" data-line-id="${lineId}">
                    <div class="grid grid-cols-12 gap-3 items-center">
                        <div class="col-span-6">
                            <select class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" onchange="updateLinePrice(${lineId})">
                                <option value="">Seleccionar producto...</option>
                                ${appState.products.map(p => `
                                    <option value="${p.id}" data-wholesale="${p.wholesalePrice}" data-retail="${p.retailPrice}" data-stock="${p.stock}">
                                        ${p.name} ${p.size} - ${p.flavor} (Stock: ${p.stock})
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="col-span-2">
                            <input type="number" placeholder="Cantidad" min="1" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" onchange="updateTotal()">
                        </div>
                        <div class="col-span-3 text-right">
                            <span class="font-medium text-gray-800">$<span class="line-subtotal">0.00</span></span>
                        </div>
                        <div class="col-span-1 text-center">
                            <button type="button" onclick="removeSaleLine(${lineId})" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-all">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('saleLines').insertAdjacentHTML('beforeend', lineHTML);
        }

        function removeSaleLine(lineId) {
            const line = document.querySelector(`[data-line-id="${lineId}"]`);
            line.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                line.remove();
                updateTotal();
            }, 300);
        }

        function updateLinePrice(lineId) {
            updateTotal();
        }

        function updatePrices() {
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            const customerType = document.getElementById('customerType').value;
            
            document.querySelectorAll('.sale-line').forEach(line => {
                const select = line.querySelector('select');
                const quantity = parseInt(line.querySelector('input[type="number"]').value) || 0;
                const subtotalSpan = line.querySelector('.line-subtotal');
                
                if (select.value && quantity > 0) {
                    const option = select.options[select.selectedIndex];
                    const price = customerType === 'mayoreo' 
                        ? parseFloat(option.dataset.wholesale)
                        : parseFloat(option.dataset.retail);
                    const subtotal = price * quantity;
                    total += subtotal;
                    subtotalSpan.textContent = subtotal.toFixed(2);
                } else {
                    subtotalSpan.textContent = '0.00';
                }
            });
            
            document.getElementById('saleTotal').textContent = total.toFixed(2);
        }

        function saveSale(event) {
            event.preventDefault();
            
            const lines = [];
            let hasProducts = false;
            let stockError = false;
            
            document.querySelectorAll('.sale-line').forEach(line => {
                const productId = line.querySelector('select').value;
                const quantity = parseInt(line.querySelector('input[type="number"]').value) || 0;
                
                if (productId && quantity > 0) {
                    const product = appState.products.find(p => p.id == productId);
                    
                    // Verificar stock
                    if (quantity > product.stock) {
                        stockError = true;
                        showToast('Stock Insuficiente', `Solo hay ${product.stock} unidades de ${product.name}`, 'error');
                        return;
                    }
                    
                    const customerType = document.getElementById('customerType').value;
                    const price = customerType === 'mayoreo' ? product.wholesalePrice : product.retailPrice;
                    
                    lines.push({
                        productId,
                        productName: product.name,
                        quantity,
                        price,
                        subtotal: price * quantity
                    });
                    hasProducts = true;
                }
            });
            
            if (stockError) return;
            
            if (!hasProducts) {
                showToast('Error', 'Agrega al menos un producto a la venta', 'warning');
                return;
            }
            
            const sale = {
                id: Date.now(),
                date: document.getElementById('saleDate').value,
                customerName: document.getElementById('customerName').value,
                customerType: document.getElementById('customerType').value,
                lines: lines,
                total: parseFloat(document.getElementById('saleTotal').textContent)
            };
            
            // Actualizar stock
            lines.forEach(line => {
                const product = appState.products.find(p => p.id == line.productId);
                product.stock -= line.quantity;
            });
            
            appState.sales.push(sale);
            saveToLocalStorage();
            updateSalesList();
            updateDashboard();
            hideSaleForm();
            
            showToast('Venta Registrada', `Venta por $${sale.total.toFixed(2)} registrada correctamente`, 'success');
        }

        function updateSalesList() {
            const tbody = document.getElementById('salesList');
            
            if (appState.sales.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-12 text-center">
                            <i class="fas fa-shopping-cart text-5xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">No hay ventas registradas</p>
                            <button onclick="showSaleForm()" class="mt-3 text-orange-500 hover:text-orange-600 font-medium">
                                Registrar primera venta ‚Üí
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Ordenar ventas por fecha (m√°s recientes primero)
            const sortedSales = [...appState.sales].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            tbody.innerHTML = sortedSales.map(sale => {
                const date = new Date(sale.date);
                const formattedDate = date.toLocaleDateString('es-MX', { 
                    day: '2-digit', 
                    month: 'short', 
                    year: 'numeric' 
                });
                
                return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm">
                                <div class="font-medium text-gray-900">${formattedDate}</div>
                                <div class="text-gray-500">${date.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' })}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-gray-500 text-xs"></i>
                                </div>
                                <div class="font-medium text-gray-900">${sale.customerName}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                sale.customerType === 'mayoreo' 
                                    ? 'bg-blue-100 text-blue-800' 
                                    : 'bg-green-100 text-green-800'
                            }">
                                ${sale.customerType === 'mayoreo' ? 'üè≠ Mayoreo' : 'üè™ Menudeo'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right">
                            <div class="text-lg font-bold text-gray-900">$${sale.total.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">${sale.lines.length} producto(s)</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button onclick="viewSale(${sale.id})" class="text-indigo-600 hover:text-indigo-900 tooltip">
                                <i class="fas fa-eye"></i>
                                <span class="tooltiptext">Ver detalles</span>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function viewSale(id) {
            const sale = appState.sales.find(s => s.id == id);
            if (sale) {
                const details = sale.lines.map(line => 
                    `<tr>
                        <td class="py-2">${line.productName}</td>
                        <td class="py-2 text-center">${line.quantity}</td>
                        <td class="py-2 text-right">$${line.price.toFixed(2)}</td>
                        <td class="py-2 text-right font-medium">$${line.subtotal.toFixed(2)}</td>
                    </tr>`
                ).join('');
                
                const modalContent = `
                    <div class="text-left">
                        <div class="mb-4">
                            <p><strong>Cliente:</strong> ${sale.customerName}</p>
                            <p><strong>Tipo:</strong> ${sale.customerType === 'mayoreo' ? 'Mayoreo' : 'Menudeo'}</p>
                            <p><strong>Fecha:</strong> ${new Date(sale.date).toLocaleDateString('es-MX')}</p>
                        </div>
                        <table class="w-full mb-4">
                            <thead class="border-b">
                                <tr>
                                    <th class="text-left py-2">Producto</th>
                                    <th class="text-center py-2">Cant.</th>
                                    <th class="text-right py-2">Precio</th>
                                    <th class="text-right py-2">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${details}
                            </tbody>
                            <tfoot class="border-t">
                                <tr>
                                    <td colspan="3" class="py-2 text-right font-bold">Total:</td>
                                    <td class="py-2 text-right font-bold text-lg">$${sale.total.toFixed(2)}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                `;
                
                // Crear modal temporal para mostrar detalles
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-md w-full animate-fadeIn">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-800">
                                <i class="fas fa-receipt mr-2 text-green-500"></i>
                                Detalle de Venta #${sale.id}
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        ${modalContent}
                        <button onclick="this.closest('.fixed').remove()" class="w-full mt-4 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                            Cerrar
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        // Actualizar estad√≠sticas de ventas
        function updateSalesStats() {
            const today = new Date().toISOString().split('T')[0];
            const todaySales = appState.sales.filter(s => s.date === today);
            const todayTotal = todaySales.reduce((sum, s) => sum + s.total, 0);
            
            document.getElementById('ventasHoy').textContent = `$${todayTotal.toFixed(2)}`;
            document.getElementById('totalTransacciones').textContent = appState.sales.length;
            
            const avgTicket = appState.sales.length > 0 
                ? appState.sales.reduce((sum, s) => sum + s.total, 0) / appState.sales.length
                : 0;
            document.getElementById('ticketPromedio').textContent = `$${avgTicket.toFixed(2)}`;
        }

        // Funciones de Dashboard
        function updateDashboard() {
            // Calcular m√©tricas
            const totalStock = appState.products.reduce((sum, p) => sum + p.stock, 0);
            const ventasMes = appState.sales.reduce((sum, s) => sum + s.total, 0);
            const clientes = new Set(appState.sales.map(s => s.customerName)).size;
            const utilidad = ventasMes * 0.3; // 30% de utilidad estimada
            
            // Actualizar valores con animaci√≥n
            animateValue('totalStock', 0, totalStock, 1000);
            animateValue('ventasMes', 0, ventasMes, 1000, true);
            animateValue('totalClientes', 0, clientes, 1000);
            animateValue('utilidad', 0, utilidad, 1000, true);
            
            // Productos con bajo stock
            const lowStock = appState.products.filter(p => p.stock < 10);
            const lowStockDiv = document.getElementById('lowStockProducts');
            
            if (lowStock.length === 0) {
                lowStockDiv.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-5xl text-green-500 mb-3"></i>
                        <p class="text-gray-500">¬°Excelente! No hay productos con bajo stock</p>
                    </div>
                `;
            } else {
                lowStockDiv.innerHTML = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="border-b border-gray-200">
                                <tr>
                                    <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">Producto</th>
                                    <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">Stock Actual</th>
                                    <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">Estado</th>
                                    <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${lowStock.map(p => `
                                    <tr class="hover:bg-yellow-50 transition-colors">
                                        <td class="py-3 px-4">
                                            <div class="flex items-center">
                                                <i class="fas fa-box text-orange-500 mr-3"></i>
                                                <div>
                                                    <div class="font-medium text-gray-900">${p.name}</div>
                                                    <div class="text-sm text-gray-500">${p.size} - ${p.flavor}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-3 px-4 text-center">
                                            <span class="text-2xl font-bold text-red-600">${p.stock}</span>
                                        </td>
                                        <td class="py-3 px-4 text-center">
                                            <span class="px-3 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">
                                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                                Cr√≠tico
                                            </span>
                                        </td>
                                        <td class="py-3 px-4 text-center">
                                            <button onclick="editProduct(${p.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                                Reabastecer ‚Üí
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }

        // Animar valores num√©ricos
        function animateValue(id, start, end, duration, isCurrency = false) {
            const element = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                
                if (isCurrency) {
                    element.textContent = `$${current.toFixed(2)}`;
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 16);
        }

        // Inicializar gr√°ficos
        function initCharts() {
            // Gr√°fico de ventas semanales
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                    datasets: [{
                        label: 'Ventas',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        borderColor: 'rgb(249, 115, 22)',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.3,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });

            // Gr√°fico de productos m√°s vendidos
            const productsCtx = document.getElementById('productsChart').getContext('2d');
            productsChart = new Chart(productsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Sin datos'],
                    datasets: [{
                        data: [1],
                        backgroundColor: ['#e5e7eb']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Actualizar gr√°ficos
        function updateCharts() {
            // Actualizar gr√°fico de ventas semanales
            const weekSales = [0, 0, 0, 0, 0, 0, 0];
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + 1); // Lunes de esta semana
            
            appState.sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate >= weekStart && saleDate <= today) {
                    const dayIndex = saleDate.getDay() === 0 ? 6 : saleDate.getDay() - 1;
                    weekSales[dayIndex] += sale.total;
                }
            });
            
            salesChart.data.datasets[0].data = weekSales;
            salesChart.update();
            
            // Actualizar gr√°fico de productos m√°s vendidos
            const productSales = {};
            appState.sales.forEach(sale => {
                sale.lines.forEach(line => {
                    if (!productSales[line.productName]) {
                        productSales[line.productName] = 0;
                    }
                    productSales[line.productName] += line.quantity;
                });
            });
            
            const sortedProducts = Object.entries(productSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            if (sortedProducts.length > 0) {
                productsChart.data.labels = sortedProducts.map(p => p[0]);
                productsChart.data.datasets[0].data = sortedProducts.map(p => p[1]);
                productsChart.data.datasets[0].backgroundColor = [
                    '#f97316',
                    '#fb923c',
                    '#fdba74',
                    '#fed7aa',
                    '#ffedd5'
                ];
            }
            productsChart.update();
        }

        // Funciones de Contabilidad
        function showAccounting(subsection) {
            document.querySelectorAll('.accounting-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(subsection).classList.remove('hidden');
            
            if (subsection === 'cuentas') updateAccountsList();
            if (subsection === 'polizas') updatePolizasList();
        }

        function addAccount() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full animate-fadeIn">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">
                        <i class="fas fa-plus mr-2 text-blue-500"></i>
                        Nueva Cuenta Contable
                    </h3>
                    <form onsubmit="event.preventDefault(); saveAccount(this);">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero de Cuenta</label>
                            <input type="text" name="number" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: 1102" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de la Cuenta</label>
                            <input type="text" name="name" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: Bancos" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Cuenta</label>
                            <select name="type" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Activo">Activo</option>
                                <option value="Pasivo">Pasivo</option>
                                <option value="Capital">Capital</option>
                                <option value="Ingreso">Ingreso</option>
                                <option value="Egreso">Egreso</option>
                            </select>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                                Cancelar
                            </button>
                            <button type="submit" class="flex-1 px-4 py-3 gradient-blue text-white rounded-lg hover:shadow-lg transition-all">
                                Guardar
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveAccount(form) {
            const account = {
                id: Date.now(),
                number: form.number.value,
                name: form.name.value,
                type: form.type.value,
                balance: 0
            };
            
            appState.accounts.push(account);
            saveToLocalStorage();
            updateAccountsList();
            form.closest('.fixed').remove();
            showToast('Cuenta Creada', 'La cuenta contable ha sido creada exitosamente', 'success');
        }

        function updateAccountsList() {
            const container = document.getElementById('accountsList');
            
            if (appState.accounts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No hay cuentas registradas</p>';
                return;
            }
            
            const groupedAccounts = appState.accounts.reduce((groups, account) => {
                if (!groups[account.type]) groups[account.type] = [];
                groups[account.type].push(account);
                return groups;
            }, {});
            
            container.innerHTML = Object.entries(groupedAccounts).map(([type, accounts]) => `
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-folder mr-2 text-${type === 'Activo' ? 'blue' : type === 'Pasivo' ? 'red' : type === 'Capital' ? 'purple' : type === 'Ingreso' ? 'green' : 'orange'}-500"></i>
                        ${type}
                    </h4>
                    <div class="space-y-2">
                        ${accounts.map(account => `
                            <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center hover:bg-gray-100 transition-colors">
                                <div>
                                    <span class="font-medium text-gray-800">${account.number}</span>
                                    <span class="text-gray-600 ml-3">${account.name}</span>
                                </div>
                                <span class="font-medium text-gray-800">$${account.balance.toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function updatePolizasList() {
            const container = document.getElementById('polizasList');
            
            if (appState.polizas.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No hay p√≥lizas registradas</p>';
                return;
            }
            
            // Implementar lista de p√≥lizas
        }

        function addPoliza() {
            showToast('En Desarrollo', 'La funci√≥n de p√≥lizas contables estar√° disponible pr√≥ximamente', 'info');
        }

        function generateBalanza() {
            const balanzaDiv = document.getElementById('balanzaContent');
            
            // Calcular totales por tipo
            const totals = appState.accounts.reduce((acc, account) => {
                if (!acc[account.type]) acc[account.type] = 0;
                acc[account.type] += account.balance;
                return acc;
            }, {});
            
            balanzaDiv.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cuenta</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Saldo</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${appState.accounts.map(account => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap font-medium">${account.number}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">${account.name}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full bg-${
                                            account.type === 'Activo' ? 'blue' : 
                                            account.type === 'Pasivo' ? 'red' : 
                                            account.type === 'Capital' ? 'purple' : 
                                            account.type === 'Ingreso' ? 'green' : 'orange'
                                        }-100 text-${
                                            account.type === 'Activo' ? 'blue' : 
                                            account.type === 'Pasivo' ? 'red' : 
                                            account.type === 'Capital' ? 'purple' : 
                                            account.type === 'Ingreso' ? 'green' : 'orange'
                                        }-800">
                                            ${account.type}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right font-medium">
                                        $${account.balance.toFixed(2)}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot class="bg-gray-100 border-t-2 border-gray-300">
                            <tr>
                                <td colspan="3" class="px-6 py-4 text-right font-bold">TOTALES</td>
                                <td class="px-6 py-4 text-right font-bold">
                                    $${Object.values(totals).reduce((sum, val) => sum + val, 0).toFixed(2)}
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="mt-6 grid grid-cols-2 md:grid-cols-5 gap-4">
                    ${Object.entries(totals).map(([type, total]) => `
                        <div class="text-center p-4 bg-${
                            type === 'Activo' ? 'blue' : 
                            type === 'Pasivo' ? 'red' : 
                            type === 'Capital' ? 'purple' : 
                            type === 'Ingreso' ? 'green' : 'orange'
                        }-50 rounded-lg">
                            <p class="text-sm font-medium text-gray-700">${type}</p>
                            <p class="text-lg font-bold text-gray-900">$${total.toFixed(2)}</p>
                        </div>
                    `).join('')}
                </div>
            `;
            
            showToast('Balanza Generada', 'La balanza de comprobaci√≥n ha sido generada', 'success');
        }

        // Funciones de Reportes
        function generateReport(type) {
            const reportDiv = document.getElementById('reportContent');
            
            switch(type) {
                case 'inventario':
                    const totalValue = appState.products.reduce((sum, p) => sum + (p.stock * p.wholesalePrice), 0);
                    const totalProducts = appState.products.reduce((sum, p) => sum + p.stock, 0);
                    
                    reportDiv.innerHTML = `
                        <div class="glass-card p-8 rounded-2xl shadow-lg animate-fadeIn">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-semibold text-gray-800">
                                    <i class="fas fa-boxes mr-2 text-indigo-500"></i>
                                    Reporte de Inventario
                                </h3>
                                <button onclick="window.print()" class="text-gray-500 hover:text-gray-700 transition-colors">
                                    <i class="fas fa-print text-xl"></i>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-indigo-50 p-4 rounded-lg">
                                    <p class="text-sm text-indigo-600 mb-1">Productos √önicos</p>
                                    <p class="text-2xl font-bold text-indigo-800">${appState.products.length}</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <p class="text-sm text-purple-600 mb-1">Total Unidades</p>
                                    <p class="text-2xl font-bold text-purple-800">${totalProducts}</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <p class="text-sm text-green-600 mb-1">Valor Total</p>
                                    <p class="text-2xl font-bold text-green-800">$${totalValue.toFixed(2)}</p>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead class="bg-gray-50 border-b border-gray-200">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Producto</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Stock</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">P. Mayoreo</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">P. Menudeo</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Valor Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${appState.products.map(p => `
                                            <tr class="${p.stock < 10 ? 'bg-red-50' : ''}">
                                                <td class="px-4 py-3">
                                                    <div>
                                                        <div class="font-medium text-gray-900">${p.name}</div>
                                                        <div class="text-sm text-gray-500">${p.size} - ${p.flavor}</div>
                                                    </div>
                                                </td>
                                                <td class="px-4 py-3 text-center font-medium ${p.stock < 10 ? 'text-red-600' : ''}">${p.stock}</td>
                                                <td class="px-4 py-3 text-right">$${p.wholesalePrice.toFixed(2)}</td>
                                                <td class="px-4 py-3 text-right">$${p.retailPrice.toFixed(2)}</td>
                                                <td class="px-4 py-3 text-right font-medium">$${(p.stock * p.wholesalePrice).toFixed(2)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                    <tfoot class="bg-gray-100 border-t-2 border-gray-300">
                                        <tr>
                                            <td colspan="4" class="px-4 py-3 text-right font-bold">TOTAL INVENTARIO:</td>
                                            <td class="px-4 py-3 text-right font-bold text-lg">$${totalValue.toFixed(2)}</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'ventas':
                    const totalVentas = appState.sales.reduce((sum, s) => sum + s.total, 0);
                    const ventasPorTipo = appState.sales.reduce((acc, sale) => {
                        acc[sale.customerType] = (acc[sale.customerType] || 0) + sale.total;
                        return acc;
                    }, {});
                    
                    // An√°lisis por producto
                    const productoStats = {};
                    appState.sales.forEach(sale => {
                        sale.lines.forEach(line => {
                            if (!productoStats[line.productName]) {
                                productoStats[line.productName] = {
                                    cantidad: 0,
                                    total: 0
                                };
                            }
                            productoStats[line.productName].cantidad += line.quantity;
                            productoStats[line.productName].total += line.subtotal;
                        });
                    });
                    
                    reportDiv.innerHTML = `
                        <div class="glass-card p-8 rounded-2xl shadow-lg animate-fadeIn">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-semibold text-gray-800">
                                    <i class="fas fa-chart-pie mr-2 text-orange-500"></i>
                                    An√°lisis de Ventas
                                </h3>
                                <button onclick="window.print()" class="text-gray-500 hover:text-gray-700 transition-colors">
                                    <i class="fas fa-print text-xl"></i>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                <div class="bg-orange-50 p-4 rounded-lg">
                                    <p class="text-sm text-orange-600 mb-1">Total Ventas</p>
                                    <p class="text-2xl font-bold text-orange-800">$${totalVentas.toFixed(2)}</p>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <p class="text-sm text-blue-600 mb-1">Ventas Mayoreo</p>
                                    <p class="text-2xl font-bold text-blue-800">$${(ventasPorTipo.mayoreo || 0).toFixed(2)}</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <p class="text-sm text-green-600 mb-1">Ventas Menudeo</p>
                                    <p class="text-2xl font-bold text-green-800">$${(ventasPorTipo.menudeo || 0).toFixed(2)}</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <p class="text-sm text-purple-600 mb-1">Transacciones</p>
                                    <p class="text-2xl font-bold text-purple-800">${appState.sales.length}</p>
                                </div>
                            </div>
                            
                            <h4 class="font-semibold text-gray-700 mb-4">Ventas por Producto</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full mb-8">
                                    <thead class="bg-gray-50 border-b border-gray-200">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Producto</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Unidades Vendidas</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total Ventas</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">% del Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${Object.entries(productoStats)
                                            .sort((a, b) => b[1].total - a[1].total)
                                            .map(([nombre, stats]) => {
                                                const porcentaje = (stats.total / totalVentas * 100).toFixed(1);
                                                return `
                                                    <tr>
                                                        <td class="px-4 py-3 font-medium text-gray-900">${nombre}</td>
                                                        <td class="px-4 py-3 text-center">${stats.cantidad}</td>
                                                        <td class="px-4 py-3 text-right font-medium">$${stats.total.toFixed(2)}</td>
                                                        <td class="px-4 py-3 text-center">
                                                            <div class="flex items-center justify-center">
                                                                <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                                                    <div class="bg-orange-500 h-2 rounded-full" style="width: ${porcentaje}%"></div>
                                                                </div>
                                                                <span class="text-sm font-medium">${porcentaje}%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'resultados':
                    const ventas = appState.sales.reduce((sum, s) => sum + s.total, 0);
                    const costos = ventas * 0.6; // 60% costo estimado
                    const gastosOperativos = ventas * 0.15; // 15% gastos operativos estimados
                    const utilidadBruta = ventas - costos;
                    const utilidadOperativa = utilidadBruta - gastosOperativos;
                    const impuestos = utilidadOperativa * 0.3; // 30% impuestos estimados
                    const utilidadNeta = utilidadOperativa - impuestos;
                    
                    reportDiv.innerHTML = `
                        <div class="glass-card p-8 rounded-2xl shadow-lg animate-fadeIn">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-semibold text-gray-800">
                                    <i class="fas fa-file-invoice-dollar mr-2 text-green-500"></i>
                                    Estado de Resultados
                                </h3>
                                <button onclick="window.print()" class="text-gray-500 hover:text-gray-700 transition-colors">
                                    <i class="fas fa-print text-xl"></i>
                                </button>
                            </div>
                            
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <table class="min-w-full">
                                    <tbody>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-4 font-medium text-gray-900">Ventas Totales</td>
                                            <td class="py-4 text-right font-bold text-green-600 text-lg">$${ventas.toFixed(2)}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-4 text-gray-700">(-) Costo de Ventas</td>
                                            <td class="py-4 text-right text-red-600">$${costos.toFixed(2)}</td>
                                        </tr>
                                        <tr class="border-b-2 border-gray-300">
                                            <td class="py-4 font-medium text-gray-900">= Utilidad Bruta</td>
                                            <td class="py-4 text-right font-bold text-lg">$${utilidadBruta.toFixed(2)}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-4 text-gray-700">(-) Gastos Operativos</td>
                                            <td class="py-4 text-right text-red-600">$${gastosOperativos.toFixed(2)}</td>
                                        </tr>
                                        <tr class="border-b-2 border-gray-300">
                                            <td class="py-4 font-medium text-gray-900">= Utilidad Operativa</td>
                                            <td class="py-4 text-right font-bold text-lg">$${utilidadOperativa.toFixed(2)}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200">
                                            <td class="py-4 text-gray-700">(-) Impuestos (30%)</td>
                                            <td class="py-4 text-right text-red-600">$${impuestos.toFixed(2)}</td>
                                        </tr>
                                        <tr class="bg-green-50">
                                            <td class="py-4 font-bold text-gray-900 text-lg">= UTILIDAD NETA</td>
                                            <td class="py-4 text-right font-bold text-green-600 text-2xl">$${utilidadNeta.toFixed(2)}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div class="mt-6 grid grid-cols-2 gap-4">
                                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-blue-600 mb-1">Margen Bruto</p>
                                        <p class="text-2xl font-bold text-blue-800">${ventas > 0 ? (utilidadBruta / ventas * 100).toFixed(1) : 0}%</p>
                                    </div>
                                    <div class="bg-green-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-green-600 mb-1">Margen Neto</p>
                                        <p class="text-2xl font-bold text-green-800">${ventas > 0 ? (utilidadNeta / ventas * 100).toFixed(1) : 0}%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            showToast('Reporte Generado', 'El reporte ha sido generado exitosamente', 'success');
        }

        // Funciones de Configuraci√≥n
        function exportData() {
            const dataStr = JSON.stringify(appState, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `erp-malanguisimas-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Datos Exportados', 'El archivo de respaldo ha sido descargado', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        showConfirmModal(
                            'Importar Datos',
                            'Esto reemplazar√° todos los datos actuales. ¬øDeseas continuar?',
                            () => {
                                appState = data;
                                saveToLocalStorage();
                                location.reload();
                            }
                        );
                    } catch (error) {
                        showToast('Error', 'El archivo seleccionado no es v√°lido', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearData() {
            showConfirmModal(
                'Eliminar Todos los Datos',
                'Esta acci√≥n eliminar√° permanentemente todos los productos, ventas y registros del sistema. ¬øEst√°s completamente seguro?',
                () => {
                    localStorage.removeItem('erpData');
                    showToast('Datos Eliminados', 'Todos los datos han sido eliminados', 'success');
                    setTimeout(() => location.reload(), 1500);
                }
            );
        }

        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
