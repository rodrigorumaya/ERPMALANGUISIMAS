import React, { useState, useEffect } from 'react';
import { Calculator, Users, FileText, DollarSign, Building, BarChart3, Plus, Search, Calendar, Download, Eye, Edit, Trash2, X, Check, AlertCircle, CreditCard, Package, UserPlus, Phone, Mail, MapPin, Clock, TrendingUp, Filter, ChevronDown, ChevronRight } from 'lucide-react';

const App = () => {
  const [activeModule, setActiveModule] = useState('dashboard');
  const [polizas, setPolizas] = useState([]);
  const [creditos, setCreditos] = useState([]);
  const [consignas, setConsignas] = useState([]);
  const [clientes, setClientes] = useState([]);
  const [productos, setProductos] = useState([]);
  const [ventas, setVentas] = useState([]);
  const [cuentasContables, setCuentasContables] = useState([
    { id: 1, codigo: '1000', nombre: 'ACTIVO', tipo: 'titulo', nivel: 1, naturaleza: 'deudora', saldo: 0 },
    { id: 2, codigo: '1100', nombre: 'ACTIVO CIRCULANTE', tipo: 'titulo', nivel: 2, naturaleza: 'deudora', saldo: 0 },
    { id: 3, codigo: '1101', nombre: 'Caja', tipo: 'detalle', nivel: 3, naturaleza: 'deudora', saldo: 15000 },
    { id: 4, codigo: '1102', nombre: 'Bancos', tipo: 'detalle', nivel: 3, naturaleza: 'deudora', saldo: 85000 },
    { id: 5, codigo: '1103', nombre: 'Clientes', tipo: 'detalle', nivel: 3, naturaleza: 'deudora', saldo: 45000 },
    { id: 6, codigo: '1104', nombre: 'Inventarios', tipo: 'detalle', nivel: 3, naturaleza: 'deudora', saldo: 120000 },
    { id: 7, codigo: '2000', nombre: 'PASIVO', tipo: 'titulo', nivel: 1, naturaleza: 'acreedora', saldo: 0 },
    { id: 8, codigo: '2100', nombre: 'PASIVO CIRCULANTE', tipo: 'titulo', nivel: 2, naturaleza: 'acreedora', saldo: 0 },
    { id: 9, codigo: '2101', nombre: 'Proveedores', tipo: 'detalle', nivel: 3, naturaleza: 'acreedora', saldo: 35000 },
    { id: 10, codigo: '3000', nombre: 'CAPITAL', tipo: 'titulo', nivel: 1, naturaleza: 'acreedora', saldo: 0 },
    { id: 11, codigo: '3100', nombre: 'Capital Social', tipo: 'detalle', nivel: 2, naturaleza: 'acreedora', saldo: 200000 },
    { id: 12, codigo: '4000', nombre: 'INGRESOS', tipo: 'titulo', nivel: 1, naturaleza: 'acreedora', saldo: 0 },
    { id: 13, codigo: '4100', nombre: 'Ventas', tipo: 'detalle', nivel: 2, naturaleza: 'acreedora', saldo: 0 },
    { id: 14, codigo: '5000', nombre: 'GASTOS', tipo: 'titulo', nivel: 1, naturaleza: 'deudora', saldo: 0 },
    { id: 15, codigo: '5100', nombre: 'Costo de Ventas', tipo: 'detalle', nivel: 2, naturaleza: 'deudora', saldo: 0 }
  ]);
  const [showModal, setShowModal] = useState(false);
  const [modalType, setModalType] = useState('');
  const [editingItem, setEditingItem] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');

  // Estado para formularios
  const [formData, setFormData] = useState({
    // Póliza
    fecha: new Date().toISOString().split('T')[0],
    tipo: 'diario',
    concepto: '',
    movimientos: [],
    
    // Crédito
    cliente: '',
    monto: '',
    plazo: '',
    tasaInteres: '',
    fechaInicio: new Date().toISOString().split('T')[0],
    estado: 'activo',
    
    // Consigna
    producto: '',
    cantidad: '',
    fechaConsigna: new Date().toISOString().split('T')[0],
    fechaLimite: '',
    precioVenta: '',
    
    // Cliente CRM
    nombre: '',
    rfc: '',
    telefono: '',
    email: '',
    direccion: '',
    tipo: 'menudeo',
    limiteCredito: '',
    notas: ''
  });

  // Cargar datos del localStorage al iniciar
  useEffect(() => {
    const savedData = localStorage.getItem('erpData');
    if (savedData) {
      const data = JSON.parse(savedData);
      if (data.polizas) setPolizas(data.polizas);
      if (data.creditos) setCreditos(data.creditos);
      if (data.consignas) setConsignas(data.consignas);
      if (data.clientes) setClientes(data.clientes);
      if (data.productos) setProductos(data.productos);
      if (data.ventas) setVentas(data.ventas);
      if (data.cuentasContables) setCuentasContables(data.cuentasContables);
    }
  }, []);

  // Guardar datos en localStorage
  useEffect(() => {
    const dataToSave = {
      polizas,
      creditos,
      consignas,
      clientes,
      productos,
      ventas,
      cuentasContables
    };
    localStorage.setItem('erpData', JSON.stringify(dataToSave));
  }, [polizas, creditos, consignas, clientes, productos, ventas, cuentasContables]);

  // Funciones auxiliares
  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('es-MX', {
      style: 'currency',
      currency: 'MXN'
    }).format(amount || 0);
  };

  const formatDate = (date) => {
    return new Date(date).toLocaleDateString('es-MX', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };

  // Funciones del modal
  const openModal = (type, item = null) => {
    setModalType(type);
    setEditingItem(item);
    if (item) {
      setFormData({ ...formData, ...item });
    } else {
      // Reset form data
      setFormData({
        fecha: new Date().toISOString().split('T')[0],
        tipo: 'diario',
        concepto: '',
        movimientos: [],
        cliente: '',
        monto: '',
        plazo: '',
        tasaInteres: '',
        fechaInicio: new Date().toISOString().split('T')[0],
        estado: 'activo',
        producto: '',
        cantidad: '',
        fechaConsigna: new Date().toISOString().split('T')[0],
        fechaLimite: '',
        precioVenta: '',
        nombre: '',
        rfc: '',
        telefono: '',
        email: '',
        direccion: '',
        tipo: 'menudeo',
        limiteCredito: '',
        notas: ''
      });
    }
    setShowModal(true);
  };

  const closeModal = () => {
    setShowModal(false);
    setEditingItem(null);
  };

  // Agregar movimiento a póliza
  const agregarMovimientoPoliza = () => {
    setFormData({
      ...formData,
      movimientos: [...formData.movimientos, { cuenta: '', debe: 0, haber: 0 }]
    });
  };

  // Eliminar movimiento de póliza
  const eliminarMovimientoPoliza = (index) => {
    const nuevosMovimientos = formData.movimientos.filter((_, i) => i !== index);
    setFormData({ ...formData, movimientos: nuevosMovimientos });
  };

  // Actualizar movimiento de póliza
  const actualizarMovimientoPoliza = (index, field, value) => {
    const nuevosMovimientos = [...formData.movimientos];
    nuevosMovimientos[index][field] = field === 'cuenta' ? value : parseFloat(value) || 0;
    setFormData({ ...formData, movimientos: nuevosMovimientos });
  };

  // Guardar póliza
  const guardarPoliza = () => {
    const totalDebe = formData.movimientos.reduce((sum, mov) => sum + (parseFloat(mov.debe) || 0), 0);
    const totalHaber = formData.movimientos.reduce((sum, mov) => sum + (parseFloat(mov.haber) || 0), 0);
    
    if (Math.abs(totalDebe - totalHaber) > 0.01) {
      alert('La póliza no está balanceada. El debe y el haber deben ser iguales.');
      return;
    }

    const nuevaPoliza = {
      id: editingItem ? editingItem.id : Date.now(),
      numero: editingItem ? editingItem.numero : polizas.length + 1,
      fecha: formData.fecha,
      tipo: formData.tipo,
      concepto: formData.concepto,
      movimientos: formData.movimientos,
      totalDebe,
      totalHaber,
      estado: 'registrada'
    };

    if (editingItem) {
      setPolizas(polizas.map(p => p.id === editingItem.id ? nuevaPoliza : p));
    } else {
      setPolizas([...polizas, nuevaPoliza]);
      
      // Actualizar saldos de cuentas contables
      formData.movimientos.forEach(mov => {
        const cuenta = cuentasContables.find(c => c.codigo === mov.cuenta);
        if (cuenta) {
          const nuevoSaldo = cuenta.naturaleza === 'deudora' 
            ? cuenta.saldo + mov.debe - mov.haber
            : cuenta.saldo + mov.haber - mov.debe;
          
          setCuentasContables(cuentasContables.map(c => 
            c.codigo === mov.cuenta ? { ...c, saldo: nuevoSaldo } : c
          ));
        }
      });
    }

    closeModal();
  };

  // Guardar crédito
  const guardarCredito = () => {
    const nuevoCredito = {
      id: editingItem ? editingItem.id : Date.now(),
      cliente: formData.cliente,
      monto: parseFloat(formData.monto),
      plazo: parseInt(formData.plazo),
      tasaInteres: parseFloat(formData.tasaInteres),
      fechaInicio: formData.fechaInicio,
      fechaVencimiento: new Date(new Date(formData.fechaInicio).setMonth(new Date(formData.fechaInicio).getMonth() + parseInt(formData.plazo))).toISOString().split('T')[0],
      estado: formData.estado,
      saldoPendiente: editingItem ? editingItem.saldoPendiente : parseFloat(formData.monto),
      pagosRealizados: editingItem ? editingItem.pagosRealizados : []
    };

    if (editingItem) {
      setCreditos(creditos.map(c => c.id === editingItem.id ? nuevoCredito : c));
    } else {
      setCreditos([...creditos, nuevoCredito]);
    }

    closeModal();
  };

  // Guardar consigna
  const guardarConsigna = () => {
    const nuevaConsigna = {
      id: editingItem ? editingItem.id : Date.now(),
      cliente: formData.cliente,
      producto: formData.producto,
      cantidad: parseInt(formData.cantidad),
      fechaConsigna: formData.fechaConsigna,
      fechaLimite: formData.fechaLimite,
      precioVenta: parseFloat(formData.precioVenta),
      estado: editingItem ? editingItem.estado : 'pendiente',
      cantidadVendida: editingItem ? editingItem.cantidadVendida : 0,
      montoLiquidado: editingItem ? editingItem.montoLiquidado : 0
    };

    if (editingItem) {
      setConsignas(consignas.map(c => c.id === editingItem.id ? nuevaConsigna : c));
    } else {
      setConsignas([...consignas, nuevaConsigna]);
    }

    closeModal();
  };

  // Guardar cliente
  const guardarCliente = () => {
    const nuevoCliente = {
      id: editingItem ? editingItem.id : Date.now(),
      nombre: formData.nombre,
      rfc: formData.rfc,
      telefono: formData.telefono,
      email: formData.email,
      direccion: formData.direccion,
      tipo: formData.tipo,
      limiteCredito: parseFloat(formData.limiteCredito) || 0,
      saldoPendiente: editingItem ? editingItem.saldoPendiente : 0,
      totalCompras: editingItem ? editingItem.totalCompras : 0,
      ultimaCompra: editingItem ? editingItem.ultimaCompra : null,
      notas: formData.notas,
      fechaRegistro: editingItem ? editingItem.fechaRegistro : new Date().toISOString()
    };

    if (editingItem) {
      setClientes(clientes.map(c => c.id === editingItem.id ? nuevoCliente : c));
    } else {
      setClientes([...clientes, nuevoCliente]);
    }

    closeModal();
  };

  // Componente del Dashboard
  const Dashboard = () => {
    const ventasDelMes = ventas.filter(v => {
      const ventaDate = new Date(v.fecha);
      const now = new Date();
      return ventaDate.getMonth() === now.getMonth() && ventaDate.getFullYear() === now.getFullYear();
    }).reduce((sum, v) => sum + v.total, 0);

    const creditosActivos = creditos.filter(c => c.estado === 'activo').length;
    const consignasPendientes = consignas.filter(c => c.estado === 'pendiente').length;
    const totalClientes = clientes.length;

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Dashboard</h2>
        
        <div className="grid grid-cols-4 gap-6 mb-8">
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm">Ventas del Mes</p>
                <p className="text-2xl font-bold text-gray-800">{formatCurrency(ventasDelMes)}</p>
              </div>
              <DollarSign className="w-12 h-12 text-blue-500 opacity-20" />
            </div>
          </div>
          
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm">Total Clientes</p>
                <p className="text-2xl font-bold text-gray-800">{totalClientes}</p>
              </div>
              <Users className="w-12 h-12 text-green-500 opacity-20" />
            </div>
          </div>
          
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm">Créditos Activos</p>
                <p className="text-2xl font-bold text-gray-800">{creditosActivos}</p>
              </div>
              <CreditCard className="w-12 h-12 text-orange-500 opacity-20" />
            </div>
          </div>
          
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm">Consignas Pendientes</p>
                <p className="text-2xl font-bold text-gray-800">{consignasPendientes}</p>
              </div>
              <Package className="w-12 h-12 text-purple-500 opacity-20" />
            </div>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-6">
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-lg font-semibold text-gray-800 mb-4">Últimas Pólizas</h3>
            <div className="space-y-3">
              {polizas.slice(-5).reverse().map(poliza => (
                <div key={poliza.id} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                  <div>
                    <p className="font-medium text-gray-800">Póliza #{poliza.numero}</p>
                    <p className="text-sm text-gray-500">{poliza.concepto}</p>
                  </div>
                  <div className="text-right">
                    <p className="font-medium text-gray-800">{formatCurrency(poliza.totalDebe)}</p>
                    <p className="text-xs text-gray-500">{formatDate(poliza.fecha)}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-lg font-semibold text-gray-800 mb-4">Créditos por Vencer</h3>
            <div className="space-y-3">
              {creditos
                .filter(c => c.estado === 'activo')
                .sort((a, b) => new Date(a.fechaVencimiento) - new Date(b.fechaVencimiento))
                .slice(0, 5)
                .map(credito => {
                  const cliente = clientes.find(c => c.id === parseInt(credito.cliente));
                  const diasRestantes = Math.ceil((new Date(credito.fechaVencimiento) - new Date()) / (1000 * 60 * 60 * 24));
                  
                  return (
                    <div key={credito.id} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                      <div>
                        <p className="font-medium text-gray-800">{cliente?.nombre || 'Cliente no encontrado'}</p>
                        <p className="text-sm text-gray-500">Saldo: {formatCurrency(credito.saldoPendiente)}</p>
                      </div>
                      <div className="text-right">
                        <p className={`font-medium ${diasRestantes < 7 ? 'text-red-600' : 'text-gray-800'}`}>
                          {diasRestantes} días
                        </p>
                        <p className="text-xs text-gray-500">Vence: {formatDate(credito.fechaVencimiento)}</p>
                      </div>
                    </div>
                  );
                })}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Componente de Contabilidad
  const Contabilidad = () => {
    const [subModule, setSubModule] = useState('polizas');
    const [expandedAccounts, setExpandedAccounts] = useState([]);

    const toggleAccount = (codigo) => {
      setExpandedAccounts(prev => 
        prev.includes(codigo) 
          ? prev.filter(c => c !== codigo)
          : [...prev, codigo]
      );
    };

    const calcularSaldoCuenta = (cuenta) => {
      if (cuenta.tipo === 'detalle') {
        return cuenta.saldo;
      }
      
      // Para cuentas de título, sumar los saldos de las cuentas hijas
      const cuentasHijas = cuentasContables.filter(c => 
        c.codigo.startsWith(cuenta.codigo) && c.codigo !== cuenta.codigo
      );
      
      return cuentasHijas.reduce((sum, c) => sum + calcularSaldoCuenta(c), 0);
    };

    const CatalogoCuentas = () => (
      <div className="bg-white rounded-xl shadow-lg p-6">
        <div className="flex justify-between items-center mb-6">
          <h3 className="text-xl font-semibold text-gray-800">Catálogo de Cuentas</h3>
          <button
            onClick={() => openModal('cuenta')}
            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
          >
            <Plus className="w-4 h-4" />
            Nueva Cuenta
          </button>
        </div>

        <div className="space-y-2">
          {cuentasContables
            .filter(c => c.nivel === 1)
            .map(cuenta => (
              <div key={cuenta.id}>
                <div
                  className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer"
                  onClick={() => toggleAccount(cuenta.codigo)}
                >
                  <div className="flex items-center gap-2">
                    {cuentasContables.some(c => c.codigo.startsWith(cuenta.codigo) && c.codigo !== cuenta.codigo) && (
                      expandedAccounts.includes(cuenta.codigo) ? 
                        <ChevronDown className="w-4 h-4 text-gray-500" /> : 
                        <ChevronRight className="w-4 h-4 text-gray-500" />
                    )}
                    <span className="font-medium text-gray-800">{cuenta.codigo}</span>
                    <span className="text-gray-600">{cuenta.nombre}</span>
                  </div>
                  <span className="font-medium text-gray-800">
                    {formatCurrency(calcularSaldoCuenta(cuenta))}
                  </span>
                </div>

                {expandedAccounts.includes(cuenta.codigo) && (
                  <div className="ml-6 mt-2 space-y-2">
                    {cuentasContables
                      .filter(c => c.codigo.startsWith(cuenta.codigo) && c.codigo !== cuenta.codigo && c.nivel === 2)
                      .map(subcuenta => (
                        <div key={subcuenta.id}>
                          <div
                            className="flex items-center justify-between p-2 bg-gray-50 rounded hover:bg-gray-100 transition-colors cursor-pointer"
                            onClick={(e) => {
                              e.stopPropagation();
                              toggleAccount(subcuenta.codigo);
                            }}
                          >
                            <div className="flex items-center gap-2">
                              {cuentasContables.some(c => c.codigo.startsWith(subcuenta.codigo) && c.codigo !== subcuenta.codigo) && (
                                expandedAccounts.includes(subcuenta.codigo) ? 
                                  <ChevronDown className="w-4 h-4 text-gray-400" /> : 
                                  <ChevronRight className="w-4 h-4 text-gray-400" />
                              )}
                              <span className="text-sm text-gray-700">{subcuenta.codigo}</span>
                              <span className="text-sm text-gray-600">{subcuenta.nombre}</span>
                            </div>
                            <span className="text-sm font-medium text-gray-700">
                              {formatCurrency(calcularSaldoCuenta(subcuenta))}
                            </span>
                          </div>

                          {expandedAccounts.includes(subcuenta.codigo) && (
                            <div className="ml-6 mt-1 space-y-1">
                              {cuentasContables
                                .filter(c => c.codigo.startsWith(subcuenta.codigo) && c.codigo !== subcuenta.codigo && c.nivel === 3)
                                .map(detalle => (
                                  <div
                                    key={detalle.id}
                                    className="flex items-center justify-between p-2 bg-white rounded hover:bg-gray-50 transition-colors"
                                  >
                                    <div className="flex items-center gap-2">
                                      <span className="text-sm text-gray-600">{detalle.codigo}</span>
                                      <span className="text-sm text-gray-500">{detalle.nombre}</span>
                                    </div>
                                    <span className="text-sm font-medium text-gray-600">
                                      {formatCurrency(detalle.saldo)}
                                    </span>
                                  </div>
                                ))}
                            </div>
                          )}
                        </div>
                      ))}
                  </div>
                )}
              </div>
            ))}
        </div>
      </div>
    );

    const PolizasContables = () => (
      <div className="bg-white rounded-xl shadow-lg p-6">
        <div className="flex justify-between items-center mb-6">
          <h3 className="text-xl font-semibold text-gray-800">Pólizas Contables</h3>
          <button
            onClick={() => openModal('poliza')}
            className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
          >
            <Plus className="w-4 h-4" />
            Nueva Póliza
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="min-w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Número
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Fecha
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Tipo
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Concepto
                </th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Debe
                </th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Haber
                </th>
                <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Acciones
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {polizas.map(poliza => (
                <tr key={poliza.id} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    #{poliza.numero}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {formatDate(poliza.fecha)}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <span className="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                      {poliza.tipo}
                    </span>
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-500">
                    {poliza.concepto}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                    {formatCurrency(poliza.totalDebe)}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                    {formatCurrency(poliza.totalHaber)}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                    <button
                      onClick={() => openModal('verPoliza', poliza)}
                      className="text-indigo-600 hover:text-indigo-900 mr-3"
                    >
                      <Eye className="w-4 h-4" />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );

    const BalanzaComprobacion = () => {
      const balanza = cuentasContables
        .filter(c => c.tipo === 'detalle')
        .map(cuenta => {
          const movimientosDebe = polizas.reduce((sum, poliza) => {
            const movsCuenta = poliza.movimientos.filter(m => m.cuenta === cuenta.codigo);
            return sum + movsCuenta.reduce((s, m) => s + m.debe, 0);
          }, 0);

          const movimientosHaber = polizas.reduce((sum, poliza) => {
            const movsCuenta = poliza.movimientos.filter(m => m.cuenta === cuenta.codigo);
            return sum + movsCuenta.reduce((s, m) => s + m.haber, 0);
          }, 0);

          const saldoDeudor = cuenta.naturaleza === 'deudora' ? cuenta.saldo : 0;
          const saldoAcreedor = cuenta.naturaleza === 'acreedora' ? cuenta.saldo : 0;

          return {
            cuenta: cuenta.codigo,
            nombre: cuenta.nombre,
            saldoInicial: cuenta.saldo,
            movimientosDebe,
            movimientosHaber,
            saldoDeudor,
            saldoAcreedor
          };
        });

      const totales = balanza.reduce((acc, row) => ({
        movimientosDebe: acc.movimientosDebe + row.movimientosDebe,
        movimientosHaber: acc.movimientosHaber + row.movimientosHaber,
        saldoDeudor: acc.saldoDeudor + row.saldoDeudor,
        saldoAcreedor: acc.saldoAcreedor + row.saldoAcreedor
      }), { movimientosDebe: 0, movimientosHaber: 0, saldoDeudor: 0, saldoAcreedor: 0 });

      return (
        <div className="bg-white rounded-xl shadow-lg p-6">
          <div className="flex justify-between items-center mb-6">
            <h3 className="text-xl font-semibold text-gray-800">Balanza de Comprobación</h3>
            <button className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2">
              <Download className="w-4 h-4" />
              Exportar
            </button>
          </div>

          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Cuenta
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Nombre
                  </th>
                  <th colSpan="2" className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Movimientos
                  </th>
                  <th colSpan="2" className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Saldos
                  </th>
                </tr>
                <tr>
                  <th className="px-6 py-3"></th>
                  <th className="px-6 py-3"></th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Debe
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Haber
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Deudor
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Acreedor
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {balanza.map((row, index) => (
                  <tr key={index} className="hover:bg-gray-50">
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                      {row.cuenta}
                    </td>
                    <td className="px-6 py-4 text-sm text-gray-500">
                      {row.nombre}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                      {formatCurrency(row.movimientosDebe)}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                      {formatCurrency(row.movimientosHaber)}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                      {row.saldoDeudor > 0 ? formatCurrency(row.saldoDeudor) : ''}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                      {row.saldoAcreedor > 0 ? formatCurrency(row.saldoAcreedor) : ''}
                    </td>
                  </tr>
                ))}
              </tbody>
              <tfoot className="bg-gray-100 border-t-2 border-gray-300">
                <tr>
                  <td colSpan="2" className="px-6 py-4 text-right font-bold text-gray-900">
                    TOTALES
                  </td>
                  <td className="px-6 py-4 text-right font-bold text-gray-900">
                    {formatCurrency(totales.movimientosDebe)}
                  </td>
                  <td className="px-6 py-4 text-right font-bold text-gray-900">
                    {formatCurrency(totales.movimientosHaber)}
                  </td>
                  <td className="px-6 py-4 text-right font-bold text-gray-900">
                    {formatCurrency(totales.saldoDeudor)}
                  </td>
                  <td className="px-6 py-4 text-right font-bold text-gray-900">
                    {formatCurrency(totales.saldoAcreedor)}
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      );
    };

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Contabilidad</h2>
        
        <div className="flex gap-4 mb-6">
          <button
            onClick={() => setSubModule('polizas')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              subModule === 'polizas' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`}
          >
            Pólizas
          </button>
          <button
            onClick={() => setSubModule('catalogo')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              subModule === 'catalogo' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`}
          >
            Catálogo de Cuentas
          </button>
          <button
            onClick={() => setSubModule('balanza')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              subModule === 'balanza' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`}
          >
            Balanza de Comprobación
          </button>
        </div>

        {subModule === 'polizas' && <PolizasContables />}
        {subModule === 'catalogo' && <CatalogoCuentas />}
        {subModule === 'balanza' && <BalanzaComprobacion />}
      </div>
    );
  };

  // Componente de Créditos
  const Creditos = () => {
    const creditosActivos = creditos.filter(c => c.estado === 'activo');
    const totalCartera = creditosActivos.reduce((sum, c) => sum + c.saldoPendiente, 0);
    
    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Gestión de Créditos</h2>
        
        <div className="grid grid-cols-4 gap-6 mb-8">
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <p className="text-gray-500 text-sm">Cartera Total</p>
            <p className="text-2xl font-bold text-gray-800">{formatCurrency(totalCartera)}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <p className="text-gray-500 text-sm">Créditos Activos</p>
            <p className="text-2xl font-bold text-gray-800">{creditosActivos.length}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500">
            <p className="text-gray-500 text-sm">Vencidos</p>
            <p className="text-2xl font-bold text-gray-800">
              {creditos.filter(c => c.estado === 'vencido').length}
            </p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <p className="text-gray-500 text-sm">Tasa Promedio</p>
            <p className="text-2xl font-bold text-gray-800">
              {creditosActivos.length > 0 
                ? (creditosActivos.reduce((sum, c) => sum + c.tasaInteres, 0) / creditosActivos.length).toFixed(1) 
                : 0}%
            </p>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg p-6">
          <div className="flex justify-between items-center mb-6">
            <h3 className="text-xl font-semibold text-gray-800">Lista de Créditos</h3>
            <button
              onClick={() => openModal('credito')}
              className="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2"
            >
              <Plus className="w-4 h-4" />
              Nuevo Crédito
            </button>
          </div>

          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Cliente
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Monto Original
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Saldo Pendiente
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Plazo
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Tasa
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Vencimiento
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Estado
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {creditos.map(credito => {
                  const cliente = clientes.find(c => c.id === parseInt(credito.cliente));
                  const diasRestantes = Math.ceil((new Date(credito.fechaVencimiento) - new Date()) / (1000 * 60 * 60 * 24));
                  
                  return (
                    <tr key={credito.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="text-sm font-medium text-gray-900">
                          {cliente?.nombre || 'Cliente no encontrado'}
                        </div>
                        <div className="text-sm text-gray-500">
                          {cliente?.rfc}
                        </div>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                        {formatCurrency(credito.monto)}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-right">
                        {formatCurrency(credito.saldoPendiente)}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        {credito.plazo} meses
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        {credito.tasaInteres}%
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        <div>
                          {formatDate(credito.fechaVencimiento)}
                        </div>
                        <div className={`text-xs ${diasRestantes < 7 ? 'text-red-600 font-medium' : 'text-gray-400'}`}>
                          {diasRestantes > 0 ? `${diasRestantes} días` : 'Vencido'}
                        </div>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-center">
                        <span className={`px-2 py-1 text-xs font-medium rounded-full ${
                          credito.estado === 'activo' 
                            ? 'bg-green-100 text-green-800' 
                            : credito.estado === 'vencido' 
                            ? 'bg-red-100 text-red-800' 
                            : 'bg-gray-100 text-gray-800'
                        }`}>
                          {credito.estado}
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                        <button
                          onClick={() => openModal('pago', credito)}
                          className="text-green-600 hover:text-green-900 mr-3"
                        >
                          <DollarSign className="w-4 h-4" />
                        </button>
                        <button
                          onClick={() => openModal('credito', credito)}
                          className="text-indigo-600 hover:text-indigo-900"
                        >
                          <Edit className="w-4 h-4" />
                        </button>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // Componente de Consignas
  const Consignas = () => {
    const consignasPendientes = consignas.filter(c => c.estado === 'pendiente');
    const valorTotal = consignasPendientes.reduce((sum, c) => sum + (c.cantidad * c.precioVenta), 0);
    
    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">Gestión de Consignas</h2>
        
        <div className="grid grid-cols-4 gap-6 mb-8">
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
            <p className="text-gray-500 text-sm">Valor Total en Consigna</p>
            <p className="text-2xl font-bold text-gray-800">{formatCurrency(valorTotal)}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <p className="text-gray-500 text-sm">Consignas Activas</p>
            <p className="text-2xl font-bold text-gray-800">{consignasPendientes.length}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <p className="text-gray-500 text-sm">Liquidadas este Mes</p>
            <p className="text-2xl font-bold text-gray-800">
              {consignas.filter(c => {
                if (c.estado !== 'liquidada') return false;
                const fecha = new Date(c.fechaLiquidacion);
                const now = new Date();
                return fecha.getMonth() === now.getMonth() && fecha.getFullYear() === now.getFullYear();
              }).length}
            </p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <p className="text-gray-500 text-sm">Por Vencer</p>
            <p className="text-2xl font-bold text-gray-800">
              {consignasPendientes.filter(c => {
                const diasRestantes = Math.ceil((new Date(c.fechaLimite) - new Date()) / (1000 * 60 * 60 * 24));
                return diasRestantes <= 7 && diasRestantes > 0;
              }).length}
            </p>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg p-6">
          <div className="flex justify-between items-center mb-6">
            <h3 className="text-xl font-semibold text-gray-800">Lista de Consignas</h3>
            <button
              onClick={() => openModal('consigna')}
              className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2"
            >
              <Plus className="w-4 h-4" />
              Nueva Consigna
            </button>
          </div>

          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Cliente
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Producto
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Cantidad
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Vendido
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Precio
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Valor Total
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Fecha Límite
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Estado
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {consignas.map(consigna => {
                  const cliente = clientes.find(c => c.id === parseInt(consigna.cliente));
                  const diasRestantes = Math.ceil((new Date(consigna.fechaLimite) - new Date()) / (1000 * 60 * 60 * 24));
                  
                  return (
                    <tr key={consigna.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="text-sm font-medium text-gray-900">
                          {cliente?.nombre || 'Cliente no encontrado'}
                        </div>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        {consigna.producto}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        {consigna.cantidad}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        {consigna.cantidadVendida}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                        {formatCurrency(consigna.precioVenta)}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-right">
                        {formatCurrency(consigna.cantidad * consigna.precioVenta)}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        <div>
                          {formatDate(consigna.fechaLimite)}
                        </div>
                        {consigna.estado === 'pendiente' && (
                          <div className={`text-xs ${diasRestantes < 7 ? 'text-red-600 font-medium' : 'text-gray-400'}`}>
                            {diasRestantes > 0 ? `${diasRestantes} días` : 'Vencido'}
                          </div>
                        )}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-center">
                        <span className={`px-2 py-1 text-xs font-medium rounded-full ${
                          consigna.estado === 'pendiente' 
                            ? 'bg-yellow-100 text-yellow-800' 
                            : consigna.estado === 'liquidada' 
                            ? 'bg-green-100 text-green-800' 
                            : 'bg-gray-100 text-gray-800'
                        }`}>
                          {consigna.estado}
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                        {consigna.estado === 'pendiente' && (
                          <button
                            onClick={() => openModal('liquidarConsigna', consigna)}
                            className="text-green-600 hover:text-green-900 mr-3"
                          >
                            <Check className="w-4 h-4" />
                          </button>
                        )}
                        <button
                          onClick={() => openModal('consigna', consigna)}
                          className="text-indigo-600 hover:text-indigo-900"
                        >
                          <Edit className="w-4 h-4" />
                        </button>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // Componente CRM
  const CRM = () => {
    const clientesFiltrados = clientes.filter(cliente => 
      cliente.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
      cliente.rfc.toLowerCase().includes(searchTerm.toLowerCase()) ||
      cliente.email.toLowerCase().includes(searchTerm.toLowerCase())
    );

    const calcularEstadisticas = () => {
      const totalCompras = clientes.reduce((sum, c) => sum + c.totalCompras, 0);
      const clientesActivos = clientes.filter(c => {
        if (!c.ultimaCompra) return false;
        const diasInactivo = Math.ceil((new Date() - new Date(c.ultimaCompra)) / (1000 * 60 * 60 * 24));
        return diasInactivo <= 30;
      }).length;

      return { totalCompras, clientesActivos };
    };

    const stats = calcularEstadisticas();

    return (
      <div className="p-6">
        <h2 className="text-3xl font-bold text-gray-800 mb-8">CRM - Gestión de Clientes</h2>
        
        <div className="grid grid-cols-4 gap-6 mb-8">
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <p className="text-gray-500 text-sm">Total Clientes</p>
            <p className="text-2xl font-bold text-gray-800">{clientes.length}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <p className="text-gray-500 text-sm">Clientes Activos</p>
            <p className="text-2xl font-bold text-gray-800">{stats.clientesActivos}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <p className="text-gray-500 text-sm">Compras Totales</p>
            <p className="text-2xl font-bold text-gray-800">{formatCurrency(stats.totalCompras)}</p>
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
            <p className="text-gray-500 text-sm">Ticket Promedio</p>
            <p className="text-2xl font-bold text-gray-800">
              {formatCurrency(clientes.length > 0 ? stats.totalCompras / clientes.length : 0)}
            </p>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-lg p-6">
          <div className="flex justify-between items-center mb-6">
            <div className="flex items-center gap-4 flex-1">
              <h3 className="text-xl font-semibold text-gray-800">Clientes</h3>
              <div className="relative flex-1 max-w-md">
                <input
                  type="text"
                  placeholder="Buscar clientes..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <Search className="absolute left-3 top-2.5 w-5 h-5 text-gray-400" />
              </div>
            </div>
            <button
              onClick={() => openModal('cliente')}
              className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
            >
              <UserPlus className="w-4 h-4" />
              Nuevo Cliente
            </button>
          </div>

          <div className="overflow-x-auto">
            <table className="min-w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Cliente
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Contacto
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Tipo
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Límite Crédito
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Saldo Pendiente
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Total Compras
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Última Compra
                  </th>
                  <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {clientesFiltrados.map(cliente => {
                  const diasInactivo = cliente.ultimaCompra 
                    ? Math.ceil((new Date() - new Date(cliente.ultimaCompra)) / (1000 * 60 * 60 * 24))
                    : null;
                  
                  return (
                    <tr key={cliente.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div>
                          <div className="text-sm font-medium text-gray-900">{cliente.nombre}</div>
                          <div className="text-sm text-gray-500">{cliente.rfc}</div>
                        </div>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="text-sm text-gray-900 flex items-center gap-2">
                          <Phone className="w-4 h-4 text-gray-400" />
                          {cliente.telefono}
                        </div>
                        <div className="text-sm text-gray-500 flex items-center gap-2">
                          <Mail className="w-4 h-4 text-gray-400" />
                          {cliente.email}
                        </div>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-center">
                        <span className={`px-2 py-1 text-xs font-medium rounded-full ${
                          cliente.tipo === 'mayoreo' 
                            ? 'bg-blue-100 text-blue-800' 
                            : 'bg-green-100 text-green-800'
                        }`}>
                          {cliente.tipo}
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                        {formatCurrency(cliente.limiteCredito)}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-right">
                        <span className={cliente.saldoPendiente > 0 ? 'text-red-600' : 'text-gray-900'}>
                          {formatCurrency(cliente.saldoPendiente)}
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                        {formatCurrency(cliente.totalCompras)}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        {cliente.ultimaCompra ? (
                          <div>
                            <div>{formatDate(cliente.ultimaCompra)}</div>
                            <div className={`text-xs ${diasInactivo > 30 ? 'text-red-600' : 'text-gray-400'}`}>
                              hace {diasInactivo} días
                            </div>
                          </div>
                        ) : (
                          <span className="text-gray-400">Sin compras</span>
                        )}
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                        <button
                          onClick={() => openModal('clienteDetalle', cliente)}
                          className="text-blue-600 hover:text-blue-900 mr-3"
                        >
                          <Eye className="w-4 h-4" />
                        </button>
                        <button
                          onClick={() => openModal('cliente', cliente)}
                          className="text-indigo-600 hover:text-indigo-900"
                        >
                          <Edit className="w-4 h-4" />
                        </button>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };

  // Modal Component
  const Modal = () => {
    if (!showModal) return null;

    const renderModalContent = () => {
      switch (modalType) {
        case 'poliza':
          return (
            <div className="space-y-4">
              <h3 className="text-xl font-semibold text-gray-800">
                {editingItem ? 'Editar Póliza' : 'Nueva Póliza'}
              </h3>
              
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                  <input
                    type="date"
                    value={formData.fecha}
                    onChange={(e) => setFormData({ ...formData, fecha: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                  <select
                    value={formData.tipo}
                    onChange={(e) => setFormData({ ...formData, tipo: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="diario">Diario</option>
                    <option value="ingreso">Ingreso</option>
                    <option value="egreso">Egreso</option>
                  </select>
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Concepto</label>
                <textarea
                  value={formData.concepto}
                  onChange={(e) => setFormData({ ...formData, concepto: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="2"
                />
              </div>

              <div>
                <div className="flex justify-between items-center mb-2">
                  <label className="block text-sm font-medium text-gray-700">Movimientos</label>
                  <button
                    type="button"
                    onClick={agregarMovimientoPoliza}
                    className="text-blue-600 hover:text-blue-700 text-sm flex items-center gap-1"
                  >
                    <Plus className="w-4 h-4" />
                    Agregar línea
                  </button>
                </div>
                
                <div className="space-y-2">
                  {formData.movimientos.map((mov, index) => (
                    <div key={index} className="flex items-center gap-2">
                      <select
                        value={mov.cuenta}
                        onChange={(e) => actualizarMovimientoPoliza(index, 'cuenta', e.target.value)}
                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                      >
                        <option value="">Seleccionar cuenta...</option>
                        {cuentasContables
                          .filter(c => c.tipo === 'detalle')
                          .map(cuenta => (
                            <option key={cuenta.id} value={cuenta.codigo}>
                              {cuenta.codigo} - {cuenta.nombre}
                            </option>
                          ))}
                      </select>
                      <input
                        type="number"
                        value={mov.debe}
                        onChange={(e) => actualizarMovimientoPoliza(index, 'debe', e.target.value)}
                        placeholder="Debe"
                        className="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                      />
                      <input
                        type="number"
                        value={mov.haber}
                        onChange={(e) => actualizarMovimientoPoliza(index, 'haber', e.target.value)}
                        placeholder="Haber"
                        className="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                      />
                      <button
                        type="button"
                        onClick={() => eliminarMovimientoPoliza(index)}
                        className="text-red-600 hover:text-red-700"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  ))}
                </div>

                <div className="mt-3 flex justify-between items-center p-3 bg-gray-100 rounded-lg">
                  <span className="font-medium text-gray-700">Totales:</span>
                  <div className="flex gap-4">
                    <span className="text-sm">
                      Debe: {formatCurrency(formData.movimientos.reduce((sum, m) => sum + (parseFloat(m.debe) || 0), 0))}
                    </span>
                    <span className="text-sm">
                      Haber: {formatCurrency(formData.movimientos.reduce((sum, m) => sum + (parseFloat(m.haber) || 0), 0))}
                    </span>
                  </div>
                </div>
              </div>

              <div className="flex justify-end gap-3 mt-6">
                <button
                  onClick={closeModal}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  Cancelar
                </button>
                <button
                  onClick={guardarPoliza}
                  className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  Guardar
                </button>
              </div>
            </div>
          );

        case 'verPoliza':
          return (
            <div className="space-y-4">
              <h3 className="text-xl font-semibold text-gray-800">
                Póliza #{editingItem?.numero}
              </h3>
              
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-gray-500">Fecha</p>
                  <p className="font-medium">{formatDate(editingItem?.fecha)}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Tipo</p>
                  <p className="font-medium capitalize">{editingItem?.tipo}</p>
                </div>
              </div>

              <div>
                <p className="text-sm text-gray-500 mb-1">Concepto</p>
                <p className="font-medium">{editingItem?.concepto}</p>
              </div>

              <div>
                <p className="text-sm text-gray-500 mb-2">Movimientos</p>
                <table className="min-w-full">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Cuenta</th>
                      <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Debe</th>
                      <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Haber</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {editingItem?.movimientos.map((mov, index) => {
                      const cuenta = cuentasContables.find(c => c.codigo === mov.cuenta);
                      return (
                        <tr key={index}>
                          <td className="px-4 py-2 text-sm">
                            {mov.cuenta} - {cuenta?.nombre}
                          </td>
                          <td className="px-4 py-2 text-sm text-right">
                            {mov.debe > 0 ? formatCurrency(mov.debe) : ''}
                          </td>
                          <td className="px-4 py-2 text-sm text-right">
                            {mov.haber > 0 ? formatCurrency(mov.haber) : ''}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                  <tfoot className="bg-gray-100">
                    <tr>
                      <td className="px-4 py-2 font-medium">Totales</td>
                      <td className="px-4 py-2 text-right font-medium">
                        {formatCurrency(editingItem?.totalDebe)}
                      </td>
                      <td className="px-4 py-2 text-right font-medium">
                        {formatCurrency(editingItem?.totalHaber)}
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>

              <div className="flex justify-end">
                <button
                  onClick={closeModal}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  Cerrar
                </button>
              </div>
            </div>
          );

        case 'credito':
          return (
            <div className="space-y-4">
              <h3 className="text-xl font-semibold text-gray-800">
                {editingItem ? 'Editar Crédito' : 'Nuevo Crédito'}
              </h3>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                <select
                  value={formData.cliente}
                  onChange={(e) => setFormData({ ...formData, cliente: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                >
                  <option value="">Seleccionar cliente...</option>
                  {clientes.map(cliente => (
                    <option key={cliente.id} value={cliente.id}>
                      {cliente.nombre} - {cliente.rfc}
                    </option>
                  ))}
                </select>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Monto</label>
                  <input
                    type="number"
                    value={formData.monto}
                    onChange={(e) => setFormData({ ...formData, monto: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                    placeholder="0.00"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Plazo (meses)</label>
                  <input
                    type="number"
                    value={formData.plazo}
                    onChange={(e) => setFormData({ ...formData, plazo: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                    placeholder="12"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Tasa de Interés (%)</label>
                  <input
                    type="number"
                    value={formData.tasaInteres}
                    onChange={(e) => setFormData({ ...formData, tasaInteres: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                    placeholder="10"
                    step="0.1"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Fecha de Inicio</label>
                  <input
                    type="date"
                    value={formData.fechaInicio}
                    onChange={(e) => setFormData({ ...formData, fechaInicio: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                  />
                </div>
              </div>

              <div className="flex justify-end gap-3 mt-6">
                <button
                  onClick={closeModal}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  Cancelar
                </button>
                <button
                  onClick={guardarCredito}
                  className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"
                >
                  Guardar
                </button>
              </div>
            </div>
          );

        case 'consigna':
          return (
            <div className="space-y-4">
              <h3 className="text-xl font-semibold text-gray-800">
                {editingItem ? 'Editar Consigna' : 'Nueva Consigna'}
              </h3>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                <select
                  value={formData.cliente}
                  onChange={(e) => setFormData({ ...formData, cliente: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                >
                  <option value="">Seleccionar cliente...</option>
                  {clientes.map(cliente => (
                    <option key={cliente.id} value={cliente.id}>
                      {cliente.nombre} - {cliente.rfc}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Producto</label>
                <input
                  type="text"
                  value={formData.producto}
                  onChange={(e) => setFormData({ ...formData, producto: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                  placeholder="Nombre del producto"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Cantidad</label>
                  <input
                    type="number"
                    value={formData.cantidad}
                    onChange={(e) => setFormData({ ...formData, cantidad: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="0"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Precio de Venta</label>
                  <input
                    type="number"
                    value={formData.precioVenta}
                    onChange={(e) => setFormData({ ...formData, precioVenta: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="0.00"
                    step="0.01"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Fecha de Consigna</label>
                  <input
                    type="date"
                    value={formData.fechaConsigna}
                    onChange={(e) => setFormData({ ...formData, fechaConsigna: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Fecha Límite</label>
                  <input
                    type="date"
                    value={formData.fechaLimite}
                    onChange={(e) => setFormData({ ...formData, fechaLimite: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                  />
                </div>
              </div>

              <div className="flex justify-end gap-3 mt-6">
                <button
                  onClick={closeModal}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  Cancelar
                </button>
                <button
                  onClick={guardarConsigna}
                  className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                  Guardar
                </button>
              </div>
            </div>
          );

        case 'cliente':
          return (
            <div className="space-y-4">
              <h3 className="text-xl font-semibold text-gray-800">
                {editingItem ? 'Editar Cliente' : 'Nuevo Cliente'}
              </h3>
              
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                  <input
                    type="text"
                    value={formData.nombre}
                    onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    placeholder="Nombre completo"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">RFC</label>
                  <input
                    type="text"
                    value={formData.rfc}
                    onChange={(e) => setFormData({ ...formData, rfc: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    placeholder="RFC"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                  <input
                    type="tel"
                    value={formData.telefono}
                    onChange={(e) => setFormData({ ...formData, telefono: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    placeholder="Teléfono"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input
                    type="email"
                    value={formData.email}
                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    placeholder="correo@ejemplo.com"
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Dirección</label>
                <textarea
                  value={formData.direccion}
                  onChange={(e) => setFormData({ ...formData, direccion: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                  placeholder="Dirección completa"
                  rows="2"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Tipo de Cliente</label>
                  <select
                    value={formData.tipo}
                    onChange={(e) => setFormData({ ...formData, tipo: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                  >
                    <option value="menudeo">Menudeo</option>
                    <option value="mayoreo">Mayoreo</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Límite de Crédito</label>
                  <input
                    type="number"
                    value={formData.limiteCredito}
                    onChange={(e) => setFormData({ ...formData, limiteCredito: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    placeholder="0.00"
                    step="0.01"
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Notas</label>
                <textarea
                  value={formData.notas}
                  onChange={(e) => setFormData({ ...formData, notas: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                  placeholder="Notas adicionales"
                  rows="3"
                />
              </div>

              <div className="flex justify-end gap-3 mt-6">
                <button
                  onClick={closeModal}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  Cancelar
                </button>
                <button
                  onClick={guardarCliente}
                  className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                >
                  Guardar
                </button>
              </div>
            </div>
          );

        case 'clienteDetalle':
          const creditosCliente = creditos.filter(c => c.cliente === editingItem?.id.toString());
          const consignasCliente = consignas.filter(c => c.cliente === editingItem?.id.toString());
          
          return (
            <div className="space-y-4">
              <h3 className="text-xl font-semibold text-gray-800">
                Detalle del Cliente
              </h3>
              
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-gray-500">Nombre</p>
                  <p className="font-medium">{editingItem?.nombre}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">RFC</p>
                  <p className="font-medium">{editingItem?.rfc}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Teléfono</p>
                  <p className="font-medium">{editingItem?.telefono}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Email</p>
                  <p className="font-medium">{editingItem?.email}</p>
                </div>
              </div>

              <div>
                <p className="text-sm text-gray-500">Dirección</p>
                <p className="font-medium">{editingItem?.direccion}</p>
              </div>

              <div className="grid grid-cols-3 gap-4 py-4 border-t border-gray-200">
                <div>
                  <p className="text-sm text-gray-500">Total Compras</p>
                  <p className="text-xl font-bold text-gray-800">{formatCurrency(editingItem?.totalCompras || 0)}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Saldo Pendiente</p>
                  <p className="text-xl font-bold text-red-600">{formatCurrency(editingItem?.saldoPendiente || 0)}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500">Límite de Crédito</p>
                  <p className="text-xl font-bold text-gray-800">{formatCurrency(editingItem?.limiteCredito || 0)}</p>
                </div>
              </div>

              {creditosCliente.length > 0 && (
                <div>
                  <h4 className="font-medium text-gray-800 mb-2">Créditos Activos</h4>
                  <div className="space-y-2">
                    {creditosCliente.map(credito => (
                      <div key={credito.id} className="bg-gray-50 p-3 rounded-lg">
                        <div className="flex justify-between items-center">
                          <div>
                            <p className="font-medium">{formatCurrency(credito.monto)}</p>
                            <p className="text-sm text-gray-500">Saldo: {formatCurrency(credito.saldoPendiente)}</p>
                          </div>
                          <div className="text-right">
                            <p className="text-sm text-gray-500">Vence: {formatDate(credito.fechaVencimiento)}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {consignasCliente.length > 0 && (
                <div>
                  <h4 className="font-medium text-gray-800 mb-2">Consignas Pendientes</h4>
                  <div className="space-y-2">
                    {consignasCliente.map(consigna => (
                      <div key={consigna.id} className="bg-gray-50 p-3 rounded-lg">
                        <div className="flex justify-between items-center">
                          <div>
                            <p className="font-medium">{consigna.producto}</p>
                            <p className="text-sm text-gray-500">{consigna.cantidad} unidades</p>
                          </div>
                          <div className="text-right">
                            <p className="font-medium">{formatCurrency(consigna.cantidad * consigna.precioVenta)}</p>
                            <p className="text-sm text-gray-500">Límite: {formatDate(consigna.fechaLimite)}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {editingItem?.notas && (
                <div className="border-t border-gray-200 pt-4">
                  <p className="text-sm text-gray-500 mb-1">Notas</p>
                  <p className="text-gray-700">{editingItem.notas}</p>
                </div>
              )}

              <div className="flex justify-end">
                <button
                  onClick={closeModal}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  Cerrar
                </button>
              </div>
            </div>
          );

        default:
          return null;
      }
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
          {renderModalContent()}
        </div>
      </div>
    );
  };

  // Main App Layout
  return (
    <div className="min-h-screen bg-gray-100">
      {/* Header */}
      <header className="bg-white shadow-sm border-b border-gray-200">
        <div className="flex items-center justify-between px-6 py-4">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
              <span className="text-white font-bold text-xl">M</span>
            </div>
            <h1 className="text-2xl font-bold text-gray-800">Malanguísimas ERP</h1>
          </div>
          <div className="flex items-center gap-4">
            <span className="text-sm text-gray-500">
              {new Date().toLocaleDateString('es-MX', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </span>
            <button className="p-2 text-gray-600 hover:text-gray-800">
              <Clock className="w-5 h-5" />
            </button>
          </div>
        </div>
      </header>

      {/* Navigation */}
      <nav className="bg-white shadow-sm border-b border-gray-200">
        <div className="flex px-6">
          <button
            onClick={() => setActiveModule('dashboard')}
            className={`px-6 py-3 border-b-2 transition-colors ${
              activeModule === 'dashboard' 
                ? 'border-blue-500 text-blue-600' 
                : 'border-transparent text-gray-600 hover:text-gray-800'
            }`}
          >
            <div className="flex items-center gap-2">
              <BarChart3 className="w-4 h-4" />
              Dashboard
            </div>
          </button>
          <button
            onClick={() => setActiveModule('contabilidad')}
            className={`px-6 py-3 border-b-2 transition-colors ${
              activeModule === 'contabilidad' 
                ? 'border-blue-500 text-blue-600' 
                : 'border-transparent text-gray-600 hover:text-gray-800'
            }`}
          >
            <div className="flex items-center gap-2">
              <Calculator className="w-4 h-4" />
              Contabilidad
            </div>
          </button>
          <button
            onClick={() => setActiveModule('creditos')}
            className={`px-6 py-3 border-b-2 transition-colors ${
              activeModule === 'creditos' 
                ? 'border-blue-500 text-blue-600' 
                : 'border-transparent text-gray-600 hover:text-gray-800'
            }`}
          >
            <div className="flex items-center gap-2">
              <CreditCard className="w-4 h-4" />
              Créditos
            </div>
          </button>
          <button
            onClick={() => setActiveModule('consignas')}
            className={`px-6 py-3 border-b-2 transition-colors ${
              activeModule === 'consignas' 
                ? 'border-blue-500 text-blue-600' 
                : 'border-transparent text-gray-600 hover:text-gray-800'
            }`}
          >
            <div className="flex items-center gap-2">
              <Package className="w-4 h-4" />
              Consignas
            </div>
          </button>
          <button
            onClick={() => setActiveModule('crm')}
            className={`px-6 py-3 border-b-2 transition-colors ${
              activeModule === 'crm' 
                ? 'border-blue-500 text-blue-600' 
                : 'border-transparent text-gray-600 hover:text-gray-800'
            }`}
          >
            <div className="flex items-center gap-2">
              <Users className="w-4 h-4" />
              CRM
            </div>
          </button>
        </div>
      </nav>

      {/* Main Content */}
      <main className="min-h-[calc(100vh-8rem)]">
        {activeModule === 'dashboard' && <Dashboard />}
        {activeModule === 'contabilidad' && <Contabilidad />}
        {activeModule === 'creditos' && <Creditos />}
        {activeModule === 'consignas' && <Consignas />}
        {activeModule === 'crm' && <CRM />}
      </main>

      {/* Modal */}
      <Modal />
    </div>
  );
};

export default App;
